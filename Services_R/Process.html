<html>
<head>
<title>Process.thy</title>
</head>
<body bgcolor="#b4cdb4">



<pre><font color="#333333"><span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   1 </font></span><font color="#cc0000">(*</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   2 </font></span><font color="#cc0000">The process management services for ARINC 653 P1-5 are first created by </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   3 </font></span><font color="#cc0000">  LIANG Jin from Beihang University.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   4 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">   5 </font></span><font color="#cc0000">And this part is reviewed and corrected by ZHANG Feng from Nanyang Technological University.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   6 </font></span><font color="#cc0000">Gao Lijie from Zhejiang University also points out and revises some errors.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   7 </font></span><font color="#cc0000">*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   8 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   9 </font></span><font color="#006699"><strong>section</strong></font><font color="#6600cc">&lsaquo;</font><font color="#6600cc">S</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc">v</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">e</font><font color="#6600cc">s</font><font color="#6600cc"> </font><font color="#6600cc">o</font><font color="#6600cc">f</font><font color="#6600cc"> </font><font color="#6600cc">P</font><font color="#6600cc">r</font><font color="#6600cc">o</font><font color="#6600cc">c</font><font color="#6600cc">e</font><font color="#6600cc">s</font><font color="#6600cc">s</font><font color="#6600cc"> </font><font color="#6600cc">M</font><font color="#6600cc">a</font><font color="#6600cc">n</font><font color="#6600cc">a</font><font color="#6600cc">g</font><font color="#6600cc">e</font><font color="#6600cc">m</font><font color="#6600cc">e</font><font color="#6600cc">n</font><font color="#6600cc">t</font><font color="#6600cc">&rsaquo;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  10 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  11 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  12 </font></span><font color="#006699"><strong>theory</strong></font> Process
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  13 </font></span><font color="#009966"><strong>imports</strong></font> <font color="#ff00cc">&quot;../Scheduler/Design_Sched/Scheduler_D&quot;</font> <font color="#ff00cc">&quot;../Base_Ops/Design_BsOps/ProcessAct_D&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  14 </font></span><font color="#009966"><strong>begin</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  15 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  16 </font></span><font color="#006699"><strong>definition</strong></font> GET_PROCESS_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  17 </font></span>  <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_NAME_TYPE &rArr; 'a StaProc_sched_scheme&times;PROC_ID_TYPE option&times;RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  18 </font></span>  <font color="#ff00cc">&quot;GET_PROCESS_ID s core_id proc_name  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  19 </font></span><font color="#ff00cc">  (let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  20 </font></span><font color="#ff00cc">      cur_ProcID = getProcIDByName s cur_part_id proc_name in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  21 </font></span><font color="#ff00cc">    if cur_ProcID = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  22 </font></span><font color="#ff00cc">       (s,None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  23 </font></span><font color="#ff00cc">    else (s,cur_ProcID,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  24 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  25 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  26 </font></span><font color="#006699"><strong>definition</strong></font> GET_PROCESS_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  27 </font></span>  <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a StaProc_sched_scheme&times;PROC_STATUS_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  28 </font></span>  <font color="#ff00cc">&quot;GET_PROCESS_STATUS s core_id proc_id  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  29 </font></span><font color="#ff00cc">  (let proc_sta = procs_' s; cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  30 </font></span><font color="#ff00cc">      proc_attr = getProcAttr s (cur_part_id,proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  31 </font></span><font color="#ff00cc">      proc_status = Some &#10631;DEADLINE_TIME = deadline proc_sta (cur_part_id,proc_id),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  32 </font></span><font color="#ff00cc">                      CUR_PRIORITY = curPriority proc_sta (cur_part_id,proc_id),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  33 </font></span><font color="#ff00cc">                      PROC_STA = procSta proc_sta (cur_part_id,proc_id),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  34 </font></span><font color="#ff00cc">                      ATTRIBUTES = createdProcs proc_sta (cur_part_id,proc_id)&#10632; in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  35 </font></span><font color="#ff00cc">   if proc_attr = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  36 </font></span><font color="#ff00cc">      (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  37 </font></span><font color="#ff00cc">   else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  38 </font></span><font color="#ff00cc">       (s,proc_status, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  39 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  40 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  41 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_PROCESS <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  42 </font></span>  <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ATTR_TYPE &rArr; 'a StaProc_sched_scheme &times; PROC_ID_TYPE option&times;RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  43 </font></span>  <font color="#ff00cc">&quot;CREATE_PROCESS s core_id proc_att =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  44 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id; cur_part_cfg = getPartByID (the cur_part_id); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  45 </font></span><font color="#ff00cc">      cur_part_mod = getcurPartMode s core_id; proc_id = newUserProcID s (the cur_part_id);   </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  46 </font></span><font color="#ff00cc">      s_created_new = createProc s (the cur_part_id, proc_id) proc_att;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  47 </font></span><font color="#ff00cc">      s_created_new_prio =  setPriority s_created_new (the cur_part_id, proc_id) (BASE_PRIORITY proc_att);  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  48 </font></span><font color="#ff00cc">      s_set_created_new = setProcSta s_created_new_prio (the cur_part_id, proc_id) DORMANT in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  49 </font></span><font color="#ff00cc">  if getProcIDByName s (the cur_part_id) (PROC_ATTR_TYPE.NAME proc_att) &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  50 </font></span><font color="#ff00cc">      (s,None, NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  51 </font></span><font color="#ff00cc">  else if STACK_SZ proc_att &gt;  (MAX_STACK_SZ_VALUE) &or; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  52 </font></span><font color="#ff00cc">            BASE_PRIORITY proc_att &gt; (MAX_PRIORITY_VALUE) &or;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  53 </font></span><font color="#ff00cc">            PERIOD proc_att &gt; Int.int  (INVALID_TIMEOUT_VALUE) &or; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  54 </font></span><font color="#ff00cc">            Int.nat (TIME_CAPACITY proc_att) &gt;  (INVALID_TIMEOUT_VALUE) &or;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  55 </font></span><font color="#ff00cc">            (PERIOD proc_att &gt; 0 &and; TIME_CAPACITY proc_att &gt; (PERIOD proc_att)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  56 </font></span><font color="#ff00cc">          (s ,None,INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  57 </font></span><font color="#ff00cc">  else if (PERIOD proc_att &gt; 0 &and; Int.nat (PERIOD proc_att) mod Int.nat (partPeriod (the cur_part_cfg)) &ne; 0) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  58 </font></span><font color="#ff00cc">          (s ,None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  59 </font></span><font color="#ff00cc">  else if cur_part_mod &ne; None &and; the cur_part_mod = NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  60 </font></span><font color="#ff00cc">          (s ,None, INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  61 </font></span><font color="#ff00cc">  else (s_set_created_new ,Some proc_id, NO_ERROR))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  62 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  63 </font></span><font color="#006699"><strong>definition</strong></font> isProcOwnPreemptMtx <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  64 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; PROC_ID_TYPE &rArr; bool&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  65 </font></span>  <font color="#ff00cc">&quot;isProcOwnPreemptMtx s part_id proc_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  66 </font></span><font color="#ff00cc">   (case getUserPLMtxOwner s (part_id,PREEMPT_MUTEX_ID_TYPE) of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  67 </font></span><font color="#ff00cc">        Some PLMtxOwer &rArr; if PLMtxOwer = proc_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  68 </font></span><font color="#ff00cc">                                 True </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  69 </font></span><font color="#ff00cc">                          else False  | </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  70 </font></span><font color="#ff00cc">        None &rArr; False )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  71 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  72 </font></span><font color="#006699"><strong>primrec</strong></font> isResrcLockMtxType <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  73 </font></span>  <font color="#ff00cc">&quot;RESRC_ID_TYPE &rArr; bool&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  74 </font></span>  <font color="#ff00cc">&quot;isResrcLockMtxType (userPlMtx _) = True&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  75 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  76 </font></span><font color="#006699"><strong>definition</strong></font> resetLockPreemptMtx <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  77 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  78 </font></span>  <font color="#ff00cc">&quot;resetLockPreemptMtx s core_id part_id  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  79 </font></span><font color="#ff00cc">  (let cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  80 </font></span><font color="#ff00cc">       mtx_id = PREEMPT_MUTEX_ID_TYPE;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  81 </font></span><font color="#ff00cc">       mtx_attr_op = getUserPLMtxAttrByID s (part_id,PREEMPT_MUTEX_ID_TYPE);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  82 </font></span><font color="#ff00cc">       mtxPrio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY(the mtx_attr_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  83 </font></span><font color="#ff00cc">        s_setMtxLck = resetUserPLMtxLck s (part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  84 </font></span><font color="#ff00cc">            s_setMtxSta = setUserPLMtxAVAILABLE s_setMtxLck (part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  85 </font></span><font color="#ff00cc">            s_delMtxOwner = releaseUserPLMtxOwner s_setMtxSta (part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  86 </font></span><font color="#ff00cc">            s_setPrio = restoreCurPrioUPLMtx s_delMtxOwner (part_id,mtx_id) (part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  87 </font></span><font color="#ff00cc">       if &not; rscProcQueEmpty s (userPlMtx (part_id,mtx_id)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  88 </font></span><font color="#ff00cc">              let (s_delMtxQFstProc,pt_delProc_id) = rscQPop s_setPrio (userPlMtx (part_id,mtx_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  89 </font></span><font color="#ff00cc">                s_stopTimeq = StopTCounter s_delMtxQFstProc (part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  90 </font></span><font color="#ff00cc">                s_setMtxSta = setUserPLMtxOWNED s_stopTimeq (part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  91 </font></span><font color="#ff00cc">                s_setUMtxLck = incrementUserPLMtxLck s_setMtxSta (part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  92 </font></span><font color="#ff00cc">                s_setOwner = setUserPLMtxOwner s_setUMtxLck (part_id,mtx_id) (snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  93 </font></span><font color="#ff00cc">                s_rtnCurPrio = retainCurPrioUserPLMtx s_setOwner (part_id,mtx_id) (part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  94 </font></span><font color="#ff00cc">                s_setCurPrio = setPriority s_rtnCurPrio (part_id,snd(the pt_delProc_id)) mtxPrio;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  95 </font></span><font color="#ff00cc">                s_setReady =  procReadyHead s_setCurPrio (part_id,snd(the pt_delProc_id)) in s_setReady</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  96 </font></span><font color="#ff00cc">        else s_setPrio</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  97 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  98 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  99 </font></span><font color="#006699"><strong>definition</strong></font> releaseLockPeemptMtx <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 100 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE  &rArr; 'a STATE_scheme &times; (RETURN_CODE_TYPE option)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 101 </font></span>  <font color="#ff00cc">&quot;releaseLockPeemptMtx s core_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 102 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 103 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 104 </font></span><font color="#ff00cc">      mtx_id = PREEMPT_MUTEX_ID_TYPE;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 105 </font></span><font color="#ff00cc">      mtx_attr_op = getUserPLMtxAttrByID s (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 106 </font></span><font color="#ff00cc">      mtxPrio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY(the mtx_attr_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 107 </font></span><font color="#ff00cc">      s_decreLckCnt = decrementUserPLMtxLck s (the cur_part_id,mtx_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 108 </font></span><font color="#ff00cc">         in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 109 </font></span><font color="#ff00cc">       if the(getUserPLMtxLckCount s_decreLckCnt (the cur_part_id,mtx_id)) = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 110 </font></span><font color="#ff00cc">          let s_setMtxSta =  setUserPLMtxAVAILABLE s_decreLckCnt (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 111 </font></span><font color="#ff00cc">          s_delUMtxOwner = releaseUserPLMtxOwner s_setMtxSta (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 112 </font></span><font color="#ff00cc">          s_setPrio = restoreCurPrioUPLMtx s_delUMtxOwner (the cur_part_id,mtx_id) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 113 </font></span><font color="#ff00cc">          s_setCurProcReady = procReadyHead s_setPrio (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 114 </font></span><font color="#ff00cc">          if &not; rscProcQueEmpty s (userPlMtx (the cur_part_id,mtx_id)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 115 </font></span><font color="#ff00cc">            let (s_delMtxQFstProc,pt_delProc_id) = rscQPop s_setCurProcReady (userPlMtx (the cur_part_id,mtx_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 116 </font></span><font color="#ff00cc">                s_stopTimeq = StopTCounter s_delMtxQFstProc (the cur_part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 117 </font></span><font color="#ff00cc">                s_setMtxSta = setUserPLMtxOWNED s_stopTimeq (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 118 </font></span><font color="#ff00cc">                s_setUMtxLck = incrementUserPLMtxLck s_setMtxSta (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 119 </font></span><font color="#ff00cc">                s_setOwner = setUserPLMtxOwner s_setUMtxLck (the cur_part_id,mtx_id) (snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 120 </font></span><font color="#ff00cc">                s_rtnCurPrio = retainCurPrioUserPLMtx s_setOwner (the cur_part_id,mtx_id) (the cur_part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 121 </font></span><font color="#ff00cc">                s_setCurPrio = setPriority s_rtnCurPrio (the cur_part_id,snd(the pt_delProc_id)) mtxPrio;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 122 </font></span><font color="#ff00cc">                s_setReady =  procReadyHead s_setCurPrio (the cur_part_id,snd(the pt_delProc_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 123 </font></span><font color="#ff00cc">              ( s_setReady , None)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 124 </font></span><font color="#ff00cc">          else (s_setCurProcReady ,Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 125 </font></span><font color="#ff00cc">       else (s_decreLckCnt , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 126 </font></span><font color="#ff00cc">    )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 127 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 128 </font></span><font color="#006699"><strong>definition</strong></font> acquireLockPreemptMtx <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 129 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE  &rArr; 'a STATE_scheme &times; (RETURN_CODE_TYPE option)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 130 </font></span>  <font color="#ff00cc">&quot;acquireLockPreemptMtx s core_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 131 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 132 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 133 </font></span><font color="#ff00cc">      mtx_id = PREEMPT_MUTEX_ID_TYPE;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 134 </font></span><font color="#ff00cc">      mtx_attr_op = getUserPLMtxAttrByID s (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 135 </font></span><font color="#ff00cc">      mtxPrio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY(the mtx_attr_op)  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 136 </font></span><font color="#ff00cc">      if getUserPLMtxOwner s (the cur_part_id,mtx_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 137 </font></span><font color="#ff00cc">           let s_setOwned = setUserPLMtxOWNED s (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 138 </font></span><font color="#ff00cc">              s_setOwner = setUserPLMtxOwner s_setOwned (the cur_part_id,mtx_id) (the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 139 </font></span><font color="#ff00cc">              s_setUMtxLck = incrementUserPLMtxLck s_setOwner (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 140 </font></span><font color="#ff00cc">              s_rtnCurPrio = retainCurPrioUserPLMtx s_setUMtxLck (the cur_part_id,mtx_id) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 141 </font></span><font color="#ff00cc">              s_setCurPrio = setPriority s_rtnCurPrio (the cur_part_id,the cur_proc_id) mtxPrio</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 142 </font></span><font color="#ff00cc">           in (s_setCurPrio , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 143 </font></span><font color="#ff00cc">      else if the(getUserPLMtxOwner s (the cur_part_id,mtx_id)) = (the cur_proc_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 144 </font></span><font color="#ff00cc">               if the(getUserPLMtxLckCount s (the cur_part_id,mtx_id)) = MAX_LOCK_LVL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 145 </font></span><font color="#ff00cc">                  (s , Some INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 146 </font></span><font color="#ff00cc">               else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 147 </font></span><font color="#ff00cc">                  (incrementUserPLMtxLck s (the cur_part_id,mtx_id) , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 148 </font></span><font color="#ff00cc">      else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 149 </font></span><font color="#ff00cc">          let s_setSta = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 150 </font></span><font color="#ff00cc">              s_setWd = setWaitDiff s_setSta (the cur_part_id,the cur_proc_id) (-1);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 151 </font></span><font color="#ff00cc">              s_addMtxQue = rscQPush s_setWd (userPlMtx (the cur_part_id,mtx_id)) (the cur_part_id,the cur_proc_id)  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 152 </font></span><font color="#ff00cc">          in (s_addMtxQue , None)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 153 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 154 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 155 </font></span><font color="#006699"><strong>definition</strong></font> SET_PRIORITY <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 156 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; PRIORITY_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 157 </font></span>  <font color="#ff00cc">&quot;SET_PRIORITY s core_id proc_id proc_priority =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 158 </font></span><font color="#ff00cc">  (let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 159 </font></span><font color="#ff00cc">      proc_sta = getProcSta s (cur_part_id,proc_id); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 160 </font></span><font color="#ff00cc">      setPrio = if getProcUserPLMtx s (cur_part_id,proc_id) &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 161 </font></span><font color="#ff00cc">                        restoreCurPrioUPLMtx s (cur_part_id,PREEMPT_MUTEX_ID_TYPE) (cur_part_id,proc_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 162 </font></span><font color="#ff00cc">                    else setPriority s (cur_part_id,proc_id) proc_priority in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 163 </font></span><font color="#ff00cc">  if  getProcAttr s (cur_part_id,proc_id) = None  &or; proc_priority &gt; MAX_PRIORITY_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 164 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 165 </font></span><font color="#ff00cc">  else if proc_sta = Some DORMANT then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 166 </font></span><font color="#ff00cc">      (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 167 </font></span><font color="#ff00cc">  else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 168 </font></span><font color="#ff00cc">      (schedule_Abs setPrio core_id  ,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 169 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 170 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 171 </font></span><font color="#006699"><strong>definition</strong></font> SUSPEND_SELF1 <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 172 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>               
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 173 </font></span>  <font color="#ff00cc">&quot;SUSPEND_SELF1 s core_id tout = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 174 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id; cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 175 </font></span><font color="#ff00cc">      procMutx = getProcUserPLMtx s (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 176 </font></span><font color="#ff00cc">      s_alone = procAlone s (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 177 </font></span><font color="#ff00cc">      s_setSta = setProcSta s_alone (the cur_part_id, the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 178 </font></span><font color="#ff00cc">      s_setWd = setSuspDiff s_setSta (the cur_part_id, the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 179 </font></span><font color="#ff00cc">      s_setWd_qadd = suspQueAdd_D s_setWd (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 180 </font></span><font color="#ff00cc">      s_setSuspend = if tout &gt; 0 then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 181 </font></span><font color="#ff00cc">                        setCterSusp s_setWd_qadd (the cur_part_id, the cur_proc_id) (Int.int(timer_' s_setSta) +  tout)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 182 </font></span><font color="#ff00cc">                     else s_setWd;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 183 </font></span><font color="#ff00cc">      s_setCntxt = setCntxt s_setSuspend (the cur_part_id, the cur_proc_id) suspSelf  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 184 </font></span><font color="#ff00cc">   if procMutx &ne; None &or; (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 185 </font></span><font color="#ff00cc">      (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 186 </font></span><font color="#ff00cc">   else if Int.nat tout &ge; INVALID_TIMEOUT_VALUE  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 187 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 188 </font></span><font color="#ff00cc">   else if isPeriodic s (the cur_part_id, the cur_proc_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 189 </font></span><font color="#ff00cc">      (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 190 </font></span><font color="#ff00cc">   else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 191 </font></span><font color="#ff00cc">      (s , NO_ERROR) </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 192 </font></span><font color="#ff00cc">   else (schedule_Abs s_setCntxt core_id,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 193 </font></span><font color="#ff00cc">  )&quot;</font>       
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 194 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 195 </font></span><font color="#006699"><strong>definition</strong></font> SUSPEND_SELF <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 196 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>               
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 197 </font></span>  <font color="#ff00cc">&quot;SUSPEND_SELF s core_id tout = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 198 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id; cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 199 </font></span><font color="#ff00cc">      procMutx = getProcUserPLMtx s (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 200 </font></span><font color="#ff00cc">      s_alone = procAlone s (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 201 </font></span><font color="#ff00cc">      s_setSta = setProcSta s_alone (the cur_part_id, the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 202 </font></span><font color="#ff00cc">      s_set_tCounterSusp = setCterRsc s_setSta (the cur_part_id, the cur_proc_id) (Int.int(timer_' s_setSta) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 203 </font></span><font color="#ff00cc">      s_setWd = setSuspDiff s_set_tCounterSusp (the cur_part_id, the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 204 </font></span><font color="#ff00cc">      s_setSuspend = if tout = -1 then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 205 </font></span><font color="#ff00cc">                        suspProc s_setWd (the cur_part_id, the cur_proc_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 206 </font></span><font color="#ff00cc">                     else  suspQueAdd_D s_setWd (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 207 </font></span><font color="#ff00cc">      s_setCntxt = setCntxt s_setSuspend (the cur_part_id, the cur_proc_id) suspSelf  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 208 </font></span><font color="#ff00cc">   if procMutx &ne; None &or; (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 209 </font></span><font color="#ff00cc">      (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 210 </font></span><font color="#ff00cc">   else if Int.nat tout &ge; INVALID_TIMEOUT_VALUE  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 211 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 212 </font></span><font color="#ff00cc">   else if isPeriodic s (the cur_part_id, the cur_proc_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 213 </font></span><font color="#ff00cc">      (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 214 </font></span><font color="#ff00cc">   else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 215 </font></span><font color="#ff00cc">      (s , NO_ERROR) </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 216 </font></span><font color="#ff00cc">   else (schedule_Abs s_setCntxt core_id,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 217 </font></span><font color="#ff00cc">  )&quot;</font>                                         
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 218 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 219 </font></span><font color="#006699"><strong>definition</strong></font> SUSPEND_SELF' <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 220 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; V_CORE_ID_TYPE  &rArr; 'a StaProc_scheme&times;RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 221 </font></span>  <font color="#ff00cc">&quot;SUSPEND_SELF'  s core_id  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 222 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id; cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 223 </font></span><font color="#ff00cc">      cntxt = getCntxt s (the cur_part_id,the cur_proc_id); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 224 </font></span><font color="#ff00cc">      ddl = getCterRsc s (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 225 </font></span><font color="#ff00cc">   if Int.int(timer_' s) &ge; the ddl then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 226 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id), TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 227 </font></span><font color="#ff00cc">   else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 228 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id), NO_ERROR))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 229 </font></span> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 230 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 231 </font></span><font color="#006699"><strong>definition</strong></font> SUSPEND <font color="#000000"><strong>::</strong></font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 232 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a STATE_scheme&times;RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 233 </font></span>  <font color="#ff00cc">&quot;SUSPEND s core_id proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 234 </font></span><font color="#ff00cc">  (let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 235 </font></span><font color="#ff00cc">      get_proc_sta = getProcSta s (cur_part_id,proc_id);      </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 236 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 237 </font></span><font color="#ff00cc">      rsc_id_num = getRscId_Num s (cur_part_id,proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 238 </font></span><font color="#ff00cc">      s_suspendFeild = suspProc s (cur_part_id,proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 239 </font></span><font color="#ff00cc">      s_setSta = setProcSta s_suspendFeild (cur_part_id,proc_id) WAITING in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 240 </font></span><font color="#ff00cc">    if getProcUserPLMtx s (cur_part_id,proc_id) &ne; None &or; (rsc_id_num &ne; None &and; isResrcLockMtxType (fst (the rsc_id_num)) = True)  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 241 </font></span><font color="#ff00cc">      (s,INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 242 </font></span><font color="#ff00cc">    else if getProcAttr s (cur_part_id,proc_id) = None &or; (the cur_proc_id) = proc_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 243 </font></span><font color="#ff00cc">      (s,INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 244 </font></span><font color="#ff00cc">    else if get_proc_sta = Some DORMANT &or; the get_proc_sta = FAULTED then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 245 </font></span><font color="#ff00cc">      (s,INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 246 </font></span><font color="#ff00cc">    else if isPeriodic s (cur_part_id,proc_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 247 </font></span><font color="#ff00cc">      (s,INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 248 </font></span><font color="#ff00cc">    else if isSuspended s (cur_part_id,proc_id) = True then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 249 </font></span><font color="#ff00cc">      (s,NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 250 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 251 </font></span><font color="#ff00cc">      (readyDel_s_D s_setSta cur_part_id proc_id,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 252 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 253 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 254 </font></span><font color="#006699"><strong>definition</strong></font> RESUME <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 255 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a StaProc_scheme&times;RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 256 </font></span>  <font color="#ff00cc">&quot;RESUME s core_id proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 257 </font></span><font color="#ff00cc">  (let proc_sta = procs_' s; cur_proc_id = curProcID_Core s core_id; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 258 </font></span><font color="#ff00cc">      cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 259 </font></span><font color="#ff00cc">      proc_state_opt=getProcSta s (cur_part_id,proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 260 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 261 </font></span><font color="#ff00cc">      s_suspDel_D = suspInfoAllDel_D s (cur_part_id,proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 262 </font></span><font color="#ff00cc">      s_rdy_suspDel_D = procReady s_suspDel_D (cur_part_id,proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 263 </font></span><font color="#ff00cc">   if getProcAttr s (cur_part_id,proc_id) = None &or; (the cur_proc_id)=proc_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 264 </font></span><font color="#ff00cc">      ( s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 265 </font></span><font color="#ff00cc">   else if proc_state_opt = Some DORMANT then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 266 </font></span><font color="#ff00cc">      ( s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 267 </font></span><font color="#ff00cc">   else if isPeriodic s (cur_part_id,proc_id) &and; getProcSta s (cur_part_id,proc_id) &ne; Some FAULTED then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 268 </font></span><font color="#ff00cc">      ( s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 269 </font></span><font color="#ff00cc">   else if isSuspended s (cur_part_id,proc_id) = False &and; getProcSta s (cur_part_id,proc_id) &ne; Some FAULTED then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 270 </font></span><font color="#ff00cc">      (s,NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 271 </font></span><font color="#ff00cc">   else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 272 </font></span><font color="#ff00cc">      if &not;isWaitTimeOrRsc s (cur_part_id,proc_id) then (schedule_Abs s_rdy_suspDel_D core_id, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 273 </font></span><font color="#ff00cc">            else (s_suspDel_D , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 274 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 275 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 276 </font></span><font color="#cc0000">(*</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 277 </font></span><font color="#cc0000">definition RESUME :: </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 278 </font></span><font color="#cc0000">  &quot;'a StaProc_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a StaProc_scheme&times;RETURN_CODE_TYPE&quot; where</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 279 </font></span><font color="#cc0000">  &quot;RESUME s core_id proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 280 </font></span><font color="#cc0000">  (let proc_sta = procs_' s; cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 281 </font></span><font color="#cc0000">      proc_state_opt=getProcSta s proc_id; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 282 </font></span><font color="#cc0000">      s_rstSusp = rstSuspended s proc_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 283 </font></span><font color="#cc0000">      s_rdy = procReady s_rstSusp proc_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 284 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 285 </font></span><font color="#cc0000">      s_suspDel_D = suspDel_D s proc_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 286 </font></span><font color="#cc0000">      s_suspDel_D_rstSusp = rstSuspended s_suspDel_D proc_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 287 </font></span><font color="#cc0000">      s_rdy_suspDel_D = procReady s_suspDel_D_rstSusp proc_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 288 </font></span><font color="#cc0000">   if procCreated s proc_id &or; (the cur_proc_id)=proc_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 289 </font></span><font color="#cc0000">      ( s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 290 </font></span><font color="#cc0000">   else if the proc_state_opt = DORMANT then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 291 </font></span><font color="#cc0000">      ( s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 292 </font></span><font color="#cc0000">   else if isPeriodic s proc_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 293 </font></span><font color="#cc0000">      ( s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 294 </font></span><font color="#cc0000">   else if isSuspended s proc_id = True  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 295 </font></span><font color="#cc0000">      (s,NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 296 </font></span><font color="#cc0000">   else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 297 </font></span><font color="#cc0000">      (if isInSuspQ s proc_id then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 298 </font></span><font color="#cc0000">        (if &not;isWaitTimeOrRsc s proc_id then (schedule_Abs s_rdy_suspDel_D core_id, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 299 </font></span><font color="#cc0000">         else (s_suspDel_D_rstSusp, NO_ERROR))  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 300 </font></span><font color="#cc0000">      else (if &not;isWaitTimeOrRsc s proc_id then (schedule_Abs s_rdy core_id, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 301 </font></span><font color="#cc0000">            else (s_rstSusp, NO_ERROR)) )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 302 </font></span><font color="#cc0000">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 303 </font></span><font color="#cc0000">*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 304 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 305 </font></span><font color="#006699"><strong>definition</strong></font> STOP_SELF <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 306 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE  &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 307 </font></span>  <font color="#ff00cc">&quot;STOP_SELF s core_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 308 </font></span><font color="#ff00cc">   (let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 309 </font></span><font color="#ff00cc">       cur_proc_id = the(curProcID_Core s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 310 </font></span><font color="#ff00cc">      hmCalled = getHMCalled s cur_part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 311 </font></span><font color="#ff00cc">      hmStatusCalled = getHMStatusCalled s cur_part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 312 </font></span><font color="#ff00cc">       s_resetMtxL = if isProcOwnPreemptMtx s  cur_part_id  cur_proc_id  then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 313 </font></span><font color="#ff00cc">                        let </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 314 </font></span><font color="#ff00cc">                            s_reserLPMtx = resetLockPreemptMtx s core_id cur_part_id; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 315 </font></span><font color="#ff00cc">                            s_setPartLock = setCurPartLock s_reserLPMtx core_id 0</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 316 </font></span><font color="#ff00cc">                         in s_setPartLock</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 317 </font></span><font color="#ff00cc">                     else s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 318 </font></span><font color="#ff00cc">       s_setCurProcSta = setCurProcSta s_resetMtxL core_id DORMANT;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 319 </font></span><font color="#ff00cc">       s_reset_part_alone = readyDel_s_D s_setCurProcSta cur_part_id cur_proc_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 320 </font></span><font color="#ff00cc">       s_rstPrio = rstPriority s_reset_part_alone (cur_part_id,cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 321 </font></span><font color="#ff00cc">       s_rstDdl = rstDeadline s_rstPrio (cur_part_id,cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 322 </font></span><font color="#ff00cc">       s_rstDdl_rstStaCaleed = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 323 </font></span><font color="#ff00cc">        case cur_proc_id = HM_PROC_ID of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 324 </font></span><font color="#ff00cc">            True &rArr; rstHMCalled s_rstDdl cur_part_id |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 325 </font></span><font color="#ff00cc">           False &rArr; s_rstDdl;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 326 </font></span><font color="#ff00cc">      s_detectError = case hmCalled = Some False &and; hmStatusCalled = Some True of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 327 </font></span><font color="#ff00cc">            False &rArr; s_rstDdl_rstStaCaleed |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 328 </font></span><font color="#ff00cc">             True &rArr; fst(hmDetectedError_ProcAct s_rstDdl_rstStaCaleed core_id PART_ERROR0) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 329 </font></span><font color="#ff00cc">     schedule_Abs s_detectError core_id</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 330 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 331 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 332 </font></span><font color="#006699"><strong>definition</strong></font> STOP <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 333 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 334 </font></span>  <font color="#ff00cc">&quot;STOP s core_id proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 335 </font></span><font color="#ff00cc">   (let proc_sta = procs_' s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 336 </font></span><font color="#ff00cc">      cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 337 </font></span><font color="#ff00cc">      cur_proc_id = the(curProcID_Core s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 338 </font></span><font color="#ff00cc">      get_proc_sta = getProcSta s (cur_part_id,proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 339 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 340 </font></span><font color="#ff00cc">      s_resetMtxL = if isProcOwnPreemptMtx s cur_part_id cur_proc_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 341 </font></span><font color="#ff00cc">                        let s_setPartLock = setCurPartLock s core_id 0;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 342 </font></span><font color="#ff00cc">                            s_reserLPMtx = resetLockPreemptMtx s_setPartLock core_id  cur_part_id </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 343 </font></span><font color="#ff00cc">                         in s_reserLPMtx else s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 344 </font></span><font color="#ff00cc">      s_reset_part_alone = procStop s_resetMtxL (cur_part_id,proc_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 345 </font></span><font color="#ff00cc">       in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 346 </font></span><font color="#ff00cc">    if getProcAttr s (cur_part_id,proc_id) = None &or; cur_proc_id = proc_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 347 </font></span><font color="#ff00cc">       (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 348 </font></span><font color="#ff00cc">    else if proc_id = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 349 </font></span><font color="#ff00cc">        (s , NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 350 </font></span><font color="#ff00cc">    else if get_proc_sta = Some DORMANT then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 351 </font></span><font color="#ff00cc">       (s , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 352 </font></span><font color="#ff00cc">    else (schedule_Abs s_reset_part_alone core_id,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 353 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 354 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 355 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 356 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 357 </font></span><font color="#006699"><strong>definition</strong></font> START <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 358 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a StaProc_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 359 </font></span>  <font color="#ff00cc">&quot;START s core_id proc_id = start s core_id proc_id&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 360 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 361 </font></span><font color="#006699"><strong>definition</strong></font> DELAYED_START <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 362 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE  &rArr; DELAY_TIME_TYPE &rArr; 'a StaProc_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 363 </font></span>  <font color="#ff00cc">&quot;DELAYED_START s core_id proc_id delayt =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 364 </font></span><font color="#ff00cc">   (let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 365 </font></span><font color="#ff00cc">        proc_attr = getProcAttr s (cur_part_id,proc_id); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 366 </font></span><font color="#ff00cc">        period = PERIOD (the proc_attr) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 367 </font></span><font color="#ff00cc">    if proc_attr = None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 368 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 369 </font></span><font color="#ff00cc">    else if getProcSta s (cur_part_id,proc_id) &ne; Some DORMANT then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 370 </font></span><font color="#ff00cc">      (s , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 371 </font></span><font color="#ff00cc">    else if delayt &gt; INVALID_TIMEOUT_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 372 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 373 </font></span><font color="#ff00cc">    else if isPeriodic s (cur_part_id,proc_id) &and; delayt &ge;  Int.nat period then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 374 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 375 </font></span><font color="#ff00cc">    else if isPeriodic s (cur_part_id,proc_id) = False then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 376 </font></span><font color="#ff00cc">           (let s_set_priority = setPriority s (cur_part_id,proc_id) (BASE_PRIORITY(the proc_attr));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 377 </font></span><font color="#ff00cc">                s_reset_procCn = resetCntxt s_set_priority (cur_part_id,proc_id)  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 378 </font></span><font color="#ff00cc">               if getPartMode s  cur_part_id = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 379 </font></span><font color="#ff00cc">                  if delayt = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 380 </font></span><font color="#ff00cc">                       let s_toReay = procReady s_reset_procCn (cur_part_id,proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 381 </font></span><font color="#ff00cc">                        t = (Int.int(timer_'  s_toReay + Int.nat(TIME_CAPACITY(the proc_attr))));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 382 </font></span><font color="#ff00cc">                       s_toReay_ddl = case TIME_CAPACITY(the proc_attr)&gt;0 of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 383 </font></span><font color="#ff00cc">                                            True &rArr; setProcDDL s_toReay (cur_part_id,proc_id) t |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 384 </font></span><font color="#ff00cc">                                             False &rArr; s_toReay in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 385 </font></span><font color="#ff00cc">                        (schedule_Abs s_toReay_ddl core_id , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 386 </font></span><font color="#ff00cc">                  else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 387 </font></span><font color="#ff00cc">                      let s_set_waiting = setProcSta s_reset_procCn (cur_part_id,proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 388 </font></span><font color="#ff00cc">                          s_set_waiting_ddl = case TIME_CAPACITY(the proc_attr)&gt;0 of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 389 </font></span><font color="#ff00cc">                                            True &rArr; setProcDDL s_set_waiting (cur_part_id,proc_id) (Int.int(timer_'  s_set_waiting + Int.nat(TIME_CAPACITY(the proc_attr)) + delayt)) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 390 </font></span><font color="#ff00cc">                                             False &rArr; s_set_waiting;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 391 </font></span><font color="#ff00cc">                          s_setDt = setDelayT s_set_waiting_ddl (cur_part_id,proc_id) delayt;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 392 </font></span><font color="#ff00cc">                          s_setWaitDiff = setWaitDiff s_setDt (cur_part_id,proc_id) (int delayt);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 393 </font></span><font color="#ff00cc">                          s_addTimeQ = waitAdd_D s_setWaitDiff (cur_part_id,proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 394 </font></span><font color="#ff00cc">                        (schedule_Abs s_addTimeQ core_id, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 395 </font></span><font color="#ff00cc">               else  let s_set_waiting = setProcSta s_reset_procCn (cur_part_id,proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 396 </font></span><font color="#ff00cc">                         s_setDt = setDelayT s_set_waiting (cur_part_id,proc_id) delayt in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 397 </font></span><font color="#ff00cc">                        (s_setDt , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 398 </font></span><font color="#ff00cc">             )   </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 399 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 400 </font></span><font color="#ff00cc">        let s_set_priority = setPriority s (cur_part_id,proc_id) (BASE_PRIORITY(the proc_attr));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 401 </font></span><font color="#ff00cc">            s_reset_procCn = resetCntxt s_set_priority (cur_part_id,proc_id) in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 402 </font></span><font color="#ff00cc">            if getPartMode s  cur_part_id = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 403 </font></span><font color="#ff00cc">               (let set_waiting = setProcSta s_reset_procCn (cur_part_id,proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 404 </font></span><font color="#ff00cc">                  firstRls = partSchedNextTime core_id cur_part_id (int(timer_' set_waiting));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 405 </font></span><font color="#ff00cc">                  s_set_firstRls = setRlsPoint set_waiting (cur_part_id,proc_id) (firstRls + int(delayt));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 406 </font></span><font color="#ff00cc">                  s_set_firstRls_ddl = case TIME_CAPACITY(the proc_attr)&gt;0 of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 407 </font></span><font color="#ff00cc">                                            True &rArr; setProcDDL s_set_firstRls (cur_part_id,proc_id) (Int.int(Int.nat(TIME_CAPACITY(the proc_attr)) + Int.nat(firstRls))) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 408 </font></span><font color="#ff00cc">                                             False &rArr; s_set_firstRls  in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 409 </font></span><font color="#ff00cc">               (s_set_firstRls_ddl , NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 410 </font></span><font color="#ff00cc">            else let s_set_waiting = setProcSta s_reset_procCn (cur_part_id,proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 411 </font></span><font color="#ff00cc">                    s_setDt = setDelayT s_set_waiting (cur_part_id,proc_id) delayt in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 412 </font></span><font color="#ff00cc">                   (s_setDt , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 413 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 414 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 415 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 416 </font></span><font color="#006699"><strong>definition</strong></font> LOCK_PREEMPTION <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 417 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a STATE_scheme &times; LOCK_LVL_TYPE &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 418 </font></span>  <font color="#ff00cc">&quot;LOCK_PREEMPTION s core_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 419 </font></span><font color="#ff00cc">  (let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 420 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 421 </font></span><font color="#ff00cc">      cur_lockLvl = the(lockLvl(partitions_' s)cur_part_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 422 </font></span><font color="#ff00cc">      in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 423 </font></span><font color="#ff00cc">     if getUserPLMtxAttrByID s (cur_part_id,PREEMPT_MUTEX_ID_TYPE) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 424 </font></span><font color="#ff00cc">        (s , cur_lockLvl ,  INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 425 </font></span><font color="#ff00cc">     else if the cur_proc_id = HM_PROC_ID &or; getPartMode s cur_part_id &ne; Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 426 </font></span><font color="#ff00cc">        (s ,cur_lockLvl,  NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 427 </font></span><font color="#ff00cc">     else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 428 </font></span><font color="#ff00cc">        let s_aqLPMtx = acquireLockPreemptMtx s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 429 </font></span><font color="#ff00cc">            if snd s_aqLPMtx = None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 430 </font></span><font color="#ff00cc">                (schedule_Abs (fst s_aqLPMtx) core_id , cur_lockLvl , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 431 </font></span><font color="#ff00cc">            else if snd s_aqLPMtx = Some INVALID_CONFIG then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 432 </font></span><font color="#ff00cc">                (s , cur_lockLvl , INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 433 </font></span><font color="#ff00cc">            else let mtx_lock_count = the(getUserPLMtxLckCount (fst s_aqLPMtx) (cur_part_id,PREEMPT_MUTEX_ID_TYPE));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 434 </font></span><font color="#ff00cc">                    s_setPartLock = setCurPartLock s core_id mtx_lock_count in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 435 </font></span><font color="#ff00cc">                (s_setPartLock , mtx_lock_count ,  NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 436 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 437 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 438 </font></span><font color="#006699"><strong>definition</strong></font> UNLOCK_PREEMPTION <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 439 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE  &rArr; 'a STATE_scheme &times; LOCK_LVL_TYPE &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 440 </font></span>  <font color="#ff00cc">&quot;UNLOCK_PREEMPTION s core_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 441 </font></span><font color="#ff00cc">  (let  cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 442 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 443 </font></span><font color="#ff00cc">      cur_lockLvl = the(lockLvl(partitions_' s)(the cur_part_id))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 444 </font></span><font color="#ff00cc">      in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 445 </font></span><font color="#ff00cc">    if getUserPLMtxAttrByID s (the cur_part_id,PREEMPT_MUTEX_ID_TYPE) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 446 </font></span><font color="#ff00cc">        (s , cur_lockLvl , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 447 </font></span><font color="#ff00cc">    else if (the cur_proc_id) = HM_PROC_ID &or; the(curMode(partitions_' s)(the cur_part_id)) &ne;  NORMAL</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 448 </font></span><font color="#ff00cc">                         &or;  getUserPLMtxOwner s (the cur_part_id,PREEMPT_MUTEX_ID_TYPE) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 449 </font></span><font color="#ff00cc">       (s , cur_lockLvl , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 450 </font></span><font color="#ff00cc">    else if &not;isProcOwnPreemptMtx s (the cur_part_id) (the cur_proc_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 451 </font></span><font color="#ff00cc">       (s , cur_lockLvl , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 452 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 453 </font></span><font color="#ff00cc">       let s_release = releaseLockPeemptMtx s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 454 </font></span><font color="#ff00cc">       if (snd s_release) &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 455 </font></span><font color="#ff00cc">          let mtx_lock_count = the(getUserPLMtxLckCount (fst s_release) (the cur_part_id,PREEMPT_MUTEX_ID_TYPE));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 456 </font></span><font color="#ff00cc">            s_setPartLock = setPartLockS s (the cur_part_id) mtx_lock_count in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 457 </font></span><font color="#ff00cc">            (s_setPartLock , mtx_lock_count , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 458 </font></span><font color="#ff00cc">       else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 459 </font></span><font color="#ff00cc">          let s_setPartLock = setPartLockS (fst s_release) (the cur_part_id) 0 in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 460 </font></span><font color="#ff00cc">          (schedule_Abs s_setPartLock core_id , 0 , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 461 </font></span><font color="#ff00cc">       </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 462 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 463 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 464 </font></span><font color="#006699"><strong>definition</strong></font> GET_MY_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 465 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a StaProc_scheme &times; PROC_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 466 </font></span>  <font color="#ff00cc">&quot;GET_MY_ID s core_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 467 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 468 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 469 </font></span><font color="#ff00cc">    if (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 470 </font></span><font color="#ff00cc">      (s , None , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 471 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 472 </font></span><font color="#ff00cc">      (s, Some (the cur_proc_id) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 473 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 474 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 475 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 476 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 477 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 478 </font></span><font color="#009966"><strong>end</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 479 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 480 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 481 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 482 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 483 </font></span>
</font></pre>
</body>
</html>
