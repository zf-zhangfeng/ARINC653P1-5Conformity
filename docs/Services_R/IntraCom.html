<html>
<head>
<title>IntraCom.thy</title>
</head>
<body bgcolor="#ffffff">



<pre><font color="#333333"><span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   1 </font></span><font color="#cc0000">(*</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   2 </font></span><font color="#cc0000">The Intrapartition Communication services for ARINC 653 P1-5 are first created by </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   3 </font></span><font color="#cc0000">  LIANG Jin from Beihang University.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   4 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">   5 </font></span><font color="#cc0000">And this part is reviewed and corrected by ZHANG Feng from Nanyang Technological University.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   6 </font></span><font color="#cc0000">GAO Lijie from Zhejiang University also points out and revises some errors.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   7 </font></span><font color="#cc0000">*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   8 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   9 </font></span><font color="#006699"><strong>section</strong></font><font color="#6600cc">&lsaquo;</font><font color="#6600cc">S</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc">v</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">e</font><font color="#6600cc">s</font><font color="#6600cc"> </font><font color="#6600cc">o</font><font color="#6600cc">f</font><font color="#6600cc"> </font><font color="#6600cc">I</font><font color="#6600cc">n</font><font color="#6600cc">t</font><font color="#6600cc">r</font><font color="#6600cc">a</font><font color="#6600cc">P</font><font color="#6600cc">a</font><font color="#6600cc">r</font><font color="#6600cc">t</font><font color="#6600cc">i</font><font color="#6600cc">t</font><font color="#6600cc">i</font><font color="#6600cc">o</font><font color="#6600cc">n</font><font color="#6600cc"> </font><font color="#6600cc">C</font><font color="#6600cc">o</font><font color="#6600cc">m</font><font color="#6600cc">m</font><font color="#6600cc">u</font><font color="#6600cc">n</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">a</font><font color="#6600cc">t</font><font color="#6600cc">i</font><font color="#6600cc">o</font><font color="#6600cc">n</font><font color="#6600cc">s</font><font color="#6600cc">&rsaquo;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  10 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  11 </font></span><font color="#006699"><strong>theory</strong></font> IntraCom
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  12 </font></span>  <font color="#009966"><strong>imports</strong></font> <font color="#ff00cc">&quot;../Scheduler/Design_Sched/Scheduler_D&quot;</font>  <font color="#ff00cc">&quot;../Base_Ops/Design_BsOps/WaitQue_D&quot;</font> <font color="#ff00cc">&quot;../Base_Ops/Design_BsOps/ProcessAct_D&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  13 </font></span><font color="#009966"><strong>begin</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  14 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  15 </font></span><font color="#006699"><strong>definition</strong></font> <font color="#ff00cc">&quot;MAX_NUM_OF_SEMA &equiv; 256&quot;</font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  16 </font></span><font color="#006699"><strong>definition</strong></font> <font color="#ff00cc">&quot;MAX_SEMA_VALUE &equiv; 32767&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  17 </font></span><font color="#006699"><strong>definition</strong></font> <font color="#ff00cc">&quot;MAX_NUM_OF_EVENTS &equiv; 256&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  18 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  19 </font></span><font color="#006699"><strong>section</strong></font> <font color="#6600cc">&lsaquo;</font><font color="#6600cc"> </font><font color="#6600cc">b</font><font color="#6600cc">a</font><font color="#6600cc">s</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc"> </font><font color="#6600cc">f</font><font color="#6600cc">u</font><font color="#6600cc">n</font><font color="#6600cc">c</font><font color="#6600cc">t</font><font color="#6600cc">i</font><font color="#6600cc">o</font><font color="#6600cc">n</font><font color="#6600cc"> </font><font color="#6600cc">&rsaquo;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  20 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  21 </font></span><font color="#cc0000">(*create new id*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  22 </font></span><font color="#006699"><strong>definition</strong></font> newBufferID <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; BUFFER_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  23 </font></span>  <font color="#ff00cc">&quot;newBufferID s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  24 </font></span><font color="#ff00cc">  let createdBuffer = createdBuf (buffer_' s) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  25 </font></span><font color="#ff00cc">  THE buffer_id. createdBuffer (part_id, buffer_id) = None &and; buffer_id &le; MAX_NUM_OF_BUFS&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  26 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  27 </font></span><font color="#006699"><strong>definition</strong></font> newBlackbdID <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE  &rArr; BLACKBD_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  28 </font></span>  <font color="#ff00cc">&quot;newBlackbdID s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  29 </font></span><font color="#ff00cc">  let createdBlackbd = createdBbd (blackBD_' s) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  30 </font></span><font color="#ff00cc">  THE blackbd_id. createdBlackbd (part_id, blackbd_id) = None &and; blackbd_id &le; MAX_NUM_OF_BBDS&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  31 </font></span> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  32 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  33 </font></span><font color="#006699"><strong>definition</strong></font> newSemaID <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; SEMA_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  34 </font></span>  <font color="#ff00cc">&quot;newSemaID s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  35 </font></span><font color="#ff00cc">  let createdSemas = createdSema(sema_' s) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  36 </font></span><font color="#ff00cc">  THE sema_id. createdSemas (part_id, sema_id) = None &and; sema_id &le; MAX_NUM_OF_SEMA&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  37 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  38 </font></span><font color="#006699"><strong>definition</strong></font> newEventID <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; EVENT_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  39 </font></span>  <font color="#ff00cc">&quot;newEventID s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  40 </font></span><font color="#ff00cc">  let createdEvents = createdEvent (event_' s) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  41 </font></span><font color="#ff00cc">  THE event_id. createdEvents (part_id, event_id) = None &and; event_id &le; MAX_NUM_OF_EVENTS&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  42 </font></span>              
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  43 </font></span><font color="#006699"><strong>definition</strong></font> newUserMutexID <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; USER_PL_MUTEX_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  44 </font></span>  <font color="#ff00cc">&quot;newUserMutexID s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  45 </font></span><font color="#ff00cc">  (let createdUMutex =createdMtx(user_pl_Mtx_' s) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  46 </font></span><font color="#ff00cc">  (THE umtx_id. createdUMutex (part_id, umtx_id) = None &and; umtx_id &ge;0 &and; umtx_id &le; MAX_NUM_OF_MUTEXES )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  47 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  48 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  49 </font></span><font color="#cc0000">(*create new _*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  50 </font></span><font color="#006699"><strong>definition</strong></font> createBuffer <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  51 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE  &rArr; BUFFER_ID_TYPE &rArr; BUFFER_ATTR_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  52 </font></span>  <font color="#ff00cc">&quot;createBuffer s part_id buffer_id buffer_attr = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  53 </font></span><font color="#ff00cc">  s&#10631;buffer_' := (buffer_' s)&#10631;createdBuf := (createdBuf(buffer_' s))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  54 </font></span><font color="#ff00cc">                                              ((part_id,buffer_id) := Some buffer_attr)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  55 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  56 </font></span><font color="#006699"><strong>definition</strong></font> createBlackbd <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  57 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; BLACKBD_ID_TYPE &rArr; BLACKBD_ATTR_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  58 </font></span>  <font color="#ff00cc">&quot;createBlackbd s part_id blackbd_id blackbd_attr = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  59 </font></span><font color="#ff00cc">  s&#10631;blackBD_' := (blackBD_' s)&#10631;createdBbd := (createdBbd(blackBD_' s))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  60 </font></span><font color="#ff00cc">                                            ((part_id,blackbd_id) := Some blackbd_attr),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  61 </font></span><font color="#ff00cc">                              emptyID := (emptyID(blackBD_' s))((part_id,blackbd_id) := Some EMPTY)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  62 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  63 </font></span><font color="#006699"><strong>definition</strong></font> createUserSema <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  64 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; SEMA_ID_TYPE &rArr; USER_SEMA_ATTR_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  65 </font></span>  <font color="#ff00cc">&quot;createUserSema s part_id sema_id smea_attr = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  66 </font></span><font color="#ff00cc">  s&#10631;sema_' := (sema_' s)&#10631;createdSema := (createdSema(sema_' s))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  67 </font></span><font color="#ff00cc">                                              ((part_id,sema_id) := Some smea_attr)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  68 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  69 </font></span><font color="#006699"><strong>definition</strong></font> createEvent <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  70 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PART_ID_TYPE  &rArr; EVENT_ID_TYPE &rArr; EVENT_NAME_TYPE  &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  71 </font></span>  <font color="#ff00cc">&quot;createEvent s core_id part_id event_id event_name  = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  72 </font></span><font color="#ff00cc">  s&#10631;event_' := (event_' s)&#10631;createdEvent := (createdEvent(event_' s))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  73 </font></span><font color="#ff00cc">                                              ((part_id,event_id) := Some event_name)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  74 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  75 </font></span><font color="#cc0000">(*del first msg in buf msg Que*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  76 </font></span><font color="#006699"><strong>definition</strong></font> removeFstMsg <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  77 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &times; BUFFER_ID_TYPE &rArr; 'a STATE_scheme &times; Message option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  78 </font></span>  <font color="#ff00cc">&quot;removeFstMsg s pb = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  79 </font></span><font color="#ff00cc">      (let msgList = (bufmsgQue(buffer_' s)pb);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  80 </font></span><font color="#ff00cc">          fstMsg =  Some (hd (the msgList)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  81 </font></span><font color="#ff00cc">     (s&#10631;buffer_':= (buffer_' s)&#10631;bufmsgQue:=(bufmsgQue(buffer_' s))(pb:= Some (tl (the msgList)))&#10632;&#10632;,  fstMsg)) &quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  82 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  83 </font></span><font color="#006699"><strong>definition</strong></font> getBufLstMsg <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  84 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &times; BUFFER_ID_TYPE &rArr; Message option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  85 </font></span>  <font color="#ff00cc">&quot;getBufLstMsg s pb = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  86 </font></span><font color="#ff00cc">      (let msgList = (bufmsgQue(buffer_' s)pb);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  87 </font></span><font color="#ff00cc">          lstMsg =  Some (last (the msgList)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  88 </font></span><font color="#ff00cc">        if msgList = None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  89 </font></span><font color="#ff00cc">            None</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  90 </font></span><font color="#ff00cc">        else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  91 </font></span><font color="#ff00cc">         lstMsg)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  92 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  93 </font></span><font color="#cc0000">(*get context*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  94 </font></span><font color="#006699"><strong>primrec</strong></font> getSendbufCntxtMsg<font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  95 </font></span>  <font color="#ff00cc">&quot;PROC_CONTEXT_TYPE &rArr;  Message&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  96 </font></span>  <font color="#ff00cc">&quot;getSendbufCntxtMsg (sendBuf (bidm))  = snd bidm&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  97 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  98 </font></span><font color="#006699"><strong>primrec</strong></font> getSendbufCntxtBufId<font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  99 </font></span>  <font color="#ff00cc">&quot;PROC_CONTEXT_TYPE &rArr; BUFFER_ID_TYPE &quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 100 </font></span>  <font color="#ff00cc">&quot;getSendbufCntxtBufId (sendBuf (bidm))  = fst (fst bidm)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 101 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 102 </font></span><font color="#006699"><strong>primrec</strong></font> getRdBbdCntxtBbdID<font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 103 </font></span>  <font color="#ff00cc">&quot;PROC_CONTEXT_TYPE &rArr; BLACKBD_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 104 </font></span>  <font color="#ff00cc">&quot;getRdBbdCntxtBbdID (rdBbd (bbdid))  =  snd bbdid&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 105 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 106 </font></span><font color="#006699"><strong>primrec</strong></font> getRecvBufCtxt <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;PROC_CONTEXT_TYPE &rArr; (PART_ID_TYPE &times; BUFFER_ID_TYPE) &times; (temp_Message option)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 107 </font></span>  <font color="#ff00cc">&quot;getRecvBufCtxt (recvBuf bt) = bt&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 108 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 109 </font></span><font color="#006699"><strong>definition</strong></font> getBufMaxMsgSz <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 110 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &times; BUFFER_ID_TYPE &rArr; MSG_SZ_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 111 </font></span>  <font color="#ff00cc">&quot;getBufMaxMsgSz s pb = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 112 </font></span><font color="#ff00cc">  BUFFER_ATTR_TYPE.MAX_MSG_SZ(the(getBufAttrByID s pb))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 113 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 114 </font></span><font color="#006699"><strong>definition</strong></font> getBbdMaxMsgSz <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 115 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; MSG_SZ_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 116 </font></span>  <font color="#ff00cc">&quot;getBbdMaxMsgSz s pb = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 117 </font></span><font color="#ff00cc">  BLACKBD_ATTR_TYPE.MAX_MSG_SZ(the (getBbdAttrByID s pb))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 118 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 119 </font></span><font color="#cc0000">(*buf function*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 120 </font></span><font color="#006699"><strong>definition</strong></font> bufFull <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 121 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BUFFER_ID_TYPE &rArr; bool &quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 122 </font></span>  <font color="#ff00cc">&quot;bufFull s pb &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 123 </font></span><font color="#ff00cc">  let bufmsgQue_op = bufmsgQue(buffer_' s)pb;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 124 </font></span><font color="#ff00cc">      buf_attr = getBufAttrByID s pb in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 125 </font></span><font color="#ff00cc">  case bufmsgQue_op of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 126 </font></span><font color="#ff00cc">      None &rArr; False |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 127 </font></span><font color="#ff00cc">  Some bmq &rArr; length bmq &ge; BUFFER_ATTR_TYPE.MAX_NB_MSG(the(buf_attr))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 128 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 129 </font></span><font color="#006699"><strong>definition</strong></font> bufEmpty <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 130 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BUFFER_ID_TYPE &rArr; bool &quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 131 </font></span>  <font color="#ff00cc">&quot;bufEmpty s pb &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 132 </font></span><font color="#ff00cc">  let bufmsgQue_op = bufmsgQue(buffer_' s)pb;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 133 </font></span><font color="#ff00cc">      buf_attr = getBufAttrByID s pb in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 134 </font></span><font color="#ff00cc">  case bufmsgQue_op of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 135 </font></span><font color="#ff00cc">  Some bmq &rArr; length bmq &gt; 0 |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 136 </font></span><font color="#ff00cc">         _ &rArr; True&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 137 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 138 </font></span><font color="#006699"><strong>definition</strong></font> getRscQueList <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 139 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; RESRC_ID_TYPE  &rArr; ((PART_ID_TYPE &times; PROC_ID_TYPE) list) option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 140 </font></span>  <font color="#ff00cc">&quot;getRscQueList s rsc_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 141 </font></span><font color="#ff00cc">    rscQue(rscPendProcs_' s)rsc_id&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 142 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 143 </font></span><font color="#cc0000">(*blackboard function*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 144 </font></span><font color="#006699"><strong>definition</strong></font> clearBbdQue <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 145 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 146 </font></span>  <font color="#ff00cc">&quot;clearBbdQue s pb  =  s&#10631;rscPendProcs_' := (rscPendProcs_' s)&#10631;rscQue := (rscQue(rscPendProcs_' s))((bbd pb):= None )&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 147 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 148 </font></span><font color="#006699"><strong>definition</strong></font> clearPendProcs <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 149 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; RESRC_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 150 </font></span>  <font color="#ff00cc">&quot;clearPendProcs s rsc_id  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 151 </font></span><font color="#ff00cc">    s&#10631;rscPendProcs_' := (rscPendProcs_' s)&#10631;rscQue := (rscQue(rscPendProcs_' s)) (rsc_id := None)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 152 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 153 </font></span><font color="#006699"><strong>definition</strong></font> setEmptyId <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 154 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; EMPTY_INDICATOR_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 155 </font></span>  <font color="#ff00cc">&quot;setEmptyId s pb emptyid =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 156 </font></span><font color="#ff00cc">   s&#10631;blackBD_' := (blackBD_' s)&#10631;emptyID := (emptyID(blackBD_' s))(pb := Some emptyid)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 157 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 158 </font></span><font color="#006699"><strong>definition</strong></font> getEmptyId <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 159 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; EMPTY_INDICATOR_TYPE option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 160 </font></span>  <font color="#ff00cc">&quot;getEmptyId s pb  = emptyID(blackBD_' s)pb&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 161 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 162 </font></span><font color="#006699"><strong>definition</strong></font> owrtBbdMsg <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 163 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; Message &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 164 </font></span>  <font color="#ff00cc">&quot;owrtBbdMsg s pb msg = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 165 </font></span><font color="#ff00cc">   s&#10631;blackBD_' := (blackBD_' s)&#10631;msgBbd := (msgBbd(blackBD_' s))(pb := Some msg)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 166 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 167 </font></span><font color="#006699"><strong>definition</strong></font> clearBbdMsg <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 168 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE  &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 169 </font></span>  <font color="#ff00cc">&quot;clearBbdMsg s pb = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 170 </font></span><font color="#ff00cc">   s&#10631;blackBD_' := (blackBD_' s)&#10631;msgBbd := (msgBbd(blackBD_' s))(pb := None)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 171 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 172 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 173 </font></span><font color="#006699"><strong>definition</strong></font> bbdEmpty <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 174 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; bool&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 175 </font></span>  <font color="#ff00cc">&quot;bbdEmpty s pb &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 176 </font></span><font color="#ff00cc">   (emptyID(blackBD_' s)pb = Some EMPTY)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 177 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 178 </font></span><font color="#006699"><strong>definition</strong></font> readBbdMsg <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 179 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; Message option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 180 </font></span>  <font color="#ff00cc">&quot;readBbdMsg s pb =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 181 </font></span><font color="#ff00cc">   (msgBbd(blackBD_' s)pb)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 182 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 183 </font></span><font color="#cc0000">(*sema function*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 184 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 185 </font></span><font color="#006699"><strong>definition</strong></font> initSema <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 186 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; SEMA_ID_TYPE  &rArr; SEMPAPH_VALUE_TYPE &rArr; SEMPAPH_VALUE_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 187 </font></span>  <font color="#ff00cc">&quot;initSema s ps curVal MaxNVal = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 188 </font></span><font color="#ff00cc">   s&#10631;sema_':=(sema_' s)&#10631;maxValue:=(maxValue(sema_' s))(ps:=Some MaxNVal),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 189 </font></span><font color="#ff00cc">                       curValue:=(curValue(sema_' s))(ps:=Some curVal)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 190 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 191 </font></span><font color="#006699"><strong>definition</strong></font> subSemaCurVal <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 192 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; SEMA_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 193 </font></span>  <font color="#ff00cc">&quot;subSemaCurVal s ps  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 194 </font></span><font color="#ff00cc">   s&#10631;sema_' := (sema_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 195 </font></span><font color="#ff00cc">               &#10631;curValue := (curValue(sema_' s))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 196 </font></span><font color="#ff00cc">               (ps := Some ((the (curValue(sema_' s)ps))-1))&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 197 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 198 </font></span><font color="#006699"><strong>definition</strong></font> addSemaCurVal <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 199 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; SEMA_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 200 </font></span>  <font color="#ff00cc">&quot;addSemaCurVal s ps  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 201 </font></span><font color="#ff00cc">   s&#10631;sema_' := (sema_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 202 </font></span><font color="#ff00cc">               &#10631;curValue := (curValue(sema_' s))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 203 </font></span><font color="#ff00cc">               (ps := Some ((the (curValue(sema_' s)ps))+1))&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 204 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 205 </font></span><font color="#cc0000">(*evt function*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 206 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 207 </font></span><font color="#006699"><strong>definition</strong></font> setEventSta <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 208 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; EVENT_ID_TYPE &rArr; EVENT_STA_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 209 </font></span>  <font color="#ff00cc">&quot;setEventSta s pe event_sta =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 210 </font></span><font color="#ff00cc">   s&#10631;event_' := (event_' s)&#10631;eventSta := (eventSta(event_' s))(pe := Some event_sta)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 211 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 212 </font></span><font color="#006699"><strong>definition</strong></font> getBufStatus <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 213 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PART_ID_TYPE &times; BUFFER_ID_TYPE &rArr;  BUFFER_STATUS_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 214 </font></span>  <font color="#ff00cc">&quot;getBufStatus s core_id pb =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 215 </font></span><font color="#ff00cc">  &#10631;NB_MSG = length(the(bufmsgQue(buffer_' s)pb)),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 216 </font></span><font color="#ff00cc">                MAX_NB_MSG = BUFFER_ATTR_TYPE.MAX_NB_MSG(the(createdBuf(buffer_' s)pb)),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 217 </font></span><font color="#ff00cc">                MAX_MSG_SZ = BUFFER_ATTR_TYPE.MAX_MSG_SZ(the(createdBuf(buffer_' s)pb)),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 218 </font></span><font color="#ff00cc">         WAITING_PROCESSES = length(the(getRscQueList s (buf pb)))&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 219 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 220 </font></span><font color="#006699"><strong>definition</strong></font> getBbdStatus <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 221 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; BLACKBD_ID_TYPE &rArr; BLACKBD_STATUS_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 222 </font></span>  <font color="#ff00cc">&quot;getBbdStatus s pb =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 223 </font></span><font color="#ff00cc">    &#10631;EMPTY_INDICATOR = (the (emptyID(blackBD_' s)pb)),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 224 </font></span><font color="#ff00cc">          MAX_MSG_SZ = BLACKBD_ATTR_TYPE.MAX_MSG_SZ (the (createdBbd(blackBD_' s) pb)),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 225 </font></span><font color="#ff00cc">   WAITING_PROCESSES = length(the (rscQue(rscPendProcs_' s)(bbd pb))) &#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 226 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 227 </font></span><font color="#006699"><strong>definition</strong></font> getSemaStatus <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 228 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &times; SEMA_ID_TYPE &rArr;  USER_SEMA_STATUS_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 229 </font></span>  <font color="#ff00cc">&quot;getSemaStatus s ps =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 230 </font></span><font color="#ff00cc">         &#10631;CUR_VALUE = the(curValue(sema_' s)ps),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 231 </font></span><font color="#ff00cc">          MAX_VALUE = the(maxValue(sema_' s)ps),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 232 </font></span><font color="#ff00cc">  WAITING_PROCESSES = length(the(rscQue(rscPendProcs_' s)(sema ps)))&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 233 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 234 </font></span><font color="#006699"><strong>definition</strong></font> getEvtStatus <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 235 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; EVENT_ID_TYPE  &rArr; EVENT_STATUS_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 236 </font></span>  <font color="#ff00cc">&quot;getEvtStatus s pe =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 237 </font></span><font color="#ff00cc">  &#10631;EVENT_STATE = the (eventSta(event_' s)pe),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 238 </font></span><font color="#ff00cc">        WAITING_PROCESSES = length(the(rscQue(rscPendProcs_' s)(evt pe))) &#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 239 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 240 </font></span><font color="#006699"><strong>definition</strong></font> getMtxStatus <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 241 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr;  USER_PL_MUTEX_ID_TYPE &rArr; USER_PL_MUTEX_STATUS_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 242 </font></span>  <font color="#ff00cc">&quot;getMtxStatus s cid umtx_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 243 </font></span><font color="#ff00cc">  (let cur_part_id = the(curPartID s cid);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 244 </font></span><font color="#ff00cc">      mtx_attr_op = getUserPLMtxAttrByID s (cur_part_id,umtx_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 245 </font></span><font color="#ff00cc">      &#10631;MUTEX_STATE = the(getUserPLMtxSta s (cur_part_id,umtx_id)),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 246 </font></span><font color="#ff00cc">      MUTEX_OWNER =  (if the(getUserPLMtxSta s (cur_part_id,umtx_id)) &ne; OWNED then None else Some (the(getUserPLMtxOwner s (cur_part_id,umtx_id)))),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 247 </font></span><font color="#ff00cc">      MUTEX_PRIORITY = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY(the mtx_attr_op),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 248 </font></span><font color="#ff00cc">      LOCK_COUNT = the(getUserPLMtxLckCount s (cur_part_id,umtx_id)),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 249 </font></span><font color="#ff00cc">      WAITING_PROCESSES = length(getRscProcQue s (userPlMtx (cur_part_id,umtx_id)))&#10632;)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 250 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 251 </font></span><font color="#006699"><strong>primrec</strong></font> getProcList <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 252 </font></span>  <font color="#ff00cc">&quot;(PART_ID_TYPE &times; PROC_ID_TYPE) list &rArr; PROC_ID_TYPE list&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 253 </font></span>  <font color="#ff00cc">&quot;getProcList [] = []&quot;</font><font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 254 </font></span>  <font color="#ff00cc">&quot;getProcList (ab#abl) = snd(ab)#getProcList abl&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 255 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 256 </font></span><font color="#006699"><strong>definition</strong></font> getCurPrioUPLMtx <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 257 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &times; USER_PL_MUTEX_ID_TYPE &rArr; PRIORITY_TYPE option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 258 </font></span>  <font color="#ff00cc">&quot;getCurPrioUPLMtx s pu  = mtxRtnPrio(user_pl_Mtx_' s)pu&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 259 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 260 </font></span><font color="#006699"><strong>section</strong></font> <font color="#6600cc">&lsaquo;</font><font color="#6600cc"> </font><font color="#6600cc">B</font><font color="#6600cc">u</font><font color="#6600cc">f</font><font color="#6600cc">f</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc"> </font><font color="#6600cc">S</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc">v</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">e</font><font color="#6600cc">s</font><font color="#6600cc"> </font><font color="#6600cc">&rsaquo;</font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 261 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 262 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_BUFFER <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 263 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE  &rArr; BUFFER_ATTR_TYPE &rArr; 'a STATE_scheme &times; BUFFER_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 264 </font></span>  <font color="#ff00cc">&quot;CREATE_BUFFER s core_id buffer_attr = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 265 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 266 </font></span><font color="#ff00cc">      buffer_name = BUFFER_NAME buffer_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 267 </font></span><font color="#ff00cc">      mag_sz = BUFFER_ATTR_TYPE.MAX_MSG_SZ buffer_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 268 </font></span><font color="#ff00cc">      msg_nb = BUFFER_ATTR_TYPE.MAX_NB_MSG buffer_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 269 </font></span><font color="#ff00cc">      que_discip = BUFFER_ATTR_TYPE.QUE_DISCIPLINE buffer_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 270 </font></span><font color="#ff00cc">      created_bufs = size_set (getBuffsOfPart s (the cur_part_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 271 </font></span><font color="#ff00cc">   if created_bufs &ge; MAX_NUM_OF_BUFS   then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 272 </font></span><font color="#ff00cc">        (s , None , INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 273 </font></span><font color="#ff00cc">   else if getBufIDByName s (the cur_part_id) buffer_name &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 274 </font></span><font color="#ff00cc">        (s , None , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 275 </font></span><font color="#ff00cc">   else if mag_sz = 0 &or; mag_sz &lt; 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 276 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 277 </font></span><font color="#ff00cc">   else if msg_nb &lt; 0 &or; msg_nb &gt; MAX_NUM_OF_MSGS then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 278 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 279 </font></span><font color="#ff00cc">   else if getPartMode s (the cur_part_id) = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 280 </font></span><font color="#ff00cc">        (s , None , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 281 </font></span><font color="#ff00cc">   else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 282 </font></span><font color="#ff00cc">        let buffer_id = newBufferID s (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 283 </font></span><font color="#ff00cc">            s_new = createBuffer s (the cur_part_id) buffer_id buffer_attr in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 284 </font></span><font color="#ff00cc">          (s_new ,Some buffer_id, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 285 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 286 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 287 </font></span><font color="#006699"><strong>definition</strong></font> SEND_BUFFER <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 288 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BUFFER_ID_TYPE &rArr; Message &rArr; TIMEOUT_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 289 </font></span><font color="#ff00cc">    'a STATE_scheme &times; (RETURN_CODE_TYPE option)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 290 </font></span>  <font color="#ff00cc">&quot;SEND_BUFFER s core_id buf_id msg tout = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 291 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 292 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 293 </font></span><font color="#ff00cc">   if getBufAttrByID s (the cur_part_id,buf_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 294 </font></span><font color="#ff00cc">      (s , Some INVALID_PARAM)              </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 295 </font></span><font color="#ff00cc">   else if msg &gt; getBufMaxMsgSz s (the cur_part_id,buf_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 296 </font></span><font color="#ff00cc">      (s , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 297 </font></span><font color="#ff00cc">   else if msg = 0 &or; msg &lt; 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 298 </font></span><font color="#ff00cc">      (s , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 299 </font></span><font color="#ff00cc">   else if (nat tout) &gt; INVALID_TIMEOUT_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 300 </font></span><font color="#ff00cc">      (s , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 301 </font></span><font color="#ff00cc">   else if &not; bufFull s (the cur_part_id,buf_id)  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 302 </font></span><font color="#ff00cc">           if rscProcQueEmpty s (buf (the cur_part_id,buf_id)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 303 </font></span><font color="#ff00cc">              (insertBufMsg s (the cur_part_id,buf_id) msg , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 304 </font></span><font color="#ff00cc">           else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 305 </font></span><font color="#ff00cc">               let sRemov_pt_recP = rscQPop s (buf (the cur_part_id,buf_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 306 </font></span><font color="#ff00cc">                  s_cxt = setCntxt (fst sRemov_pt_recP) (the(snd sRemov_pt_recP)) (recvBuf((the cur_part_id,buf_id), Some msg));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 307 </font></span><font color="#ff00cc">                  s_stopTimeCt = StopTCounter s_cxt (the(snd sRemov_pt_recP));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 308 </font></span><font color="#ff00cc">                  s_setToReady =  if &not;isSuspended s_stopTimeCt (the(snd sRemov_pt_recP)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 309 </font></span><font color="#ff00cc">                                    procReady s_stopTimeCt (the(snd sRemov_pt_recP))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 310 </font></span><font color="#ff00cc">                                else  s_stopTimeCt in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 311 </font></span><font color="#ff00cc">                (schedule_Abs s_setToReady core_id , Some NO_ERROR)                              </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 312 </font></span><font color="#ff00cc">   else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 313 </font></span><font color="#ff00cc">           (s , Some NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 314 </font></span><font color="#ff00cc">   else if getProcUserPLMtx s (the cur_part_id,the cur_proc_id) &ne; None  &or; (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 315 </font></span><font color="#ff00cc">           (s , Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 316 </font></span><font color="#ff00cc">   else if tout = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 317 </font></span><font color="#ff00cc">            let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 318 </font></span><font color="#ff00cc">               s_insertBufQue = rscQPush s_setWaiting (buf (the cur_part_id,buf_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 319 </font></span><font color="#ff00cc">               s_setwf = setWaitDiff s_insertBufQue (the cur_part_id,the cur_proc_id) tout in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 320 </font></span><font color="#ff00cc">            (schedule_Abs s_setwf core_id , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 321 </font></span><font color="#ff00cc">   else  let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 322 </font></span><font color="#ff00cc">              s_insertBufQue = rscQPush s_setWaiting (buf (the cur_part_id,buf_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 323 </font></span><font color="#ff00cc">              s_setWaitDiff = setWaitDiff s_insertBufQue (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 324 </font></span><font color="#ff00cc">              s_waitAddTimeQ = waitAdd_D s_setWaitDiff  (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 325 </font></span><font color="#ff00cc">              s_setTCtrRsc = setCterRsc s_waitAddTimeQ (the cur_part_id,the cur_proc_id) (Int.int(timer_' s_waitAddTimeQ) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 326 </font></span><font color="#ff00cc">              s_setCntxt = setCntxt s_setTCtrRsc (the cur_part_id,the cur_proc_id) (sendBuf ((the cur_part_id,buf_id),msg)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 327 </font></span><font color="#ff00cc">          (schedule_Abs s_setCntxt core_id , None)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 328 </font></span><font color="#ff00cc">          </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 329 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 330 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 331 </font></span><font color="#006699"><strong>definition</strong></font> SEND_BUFFER' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 332 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 333 </font></span>  <font color="#ff00cc">&quot;SEND_BUFFER' s core_id tout =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 334 </font></span><font color="#ff00cc">  (let cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 335 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 336 </font></span><font color="#ff00cc">      t_getCterRsc = getCterRsc s (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 337 </font></span><font color="#ff00cc">    if (the t_getCterRsc) &lt;= Int.int(timer_' s) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 338 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id) , TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 339 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 340 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id) , NO_ERROR))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 341 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 342 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 343 </font></span><font color="#006699"><strong>definition</strong></font> RECEIVE_BUFFER <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 344 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BUFFER_ID_TYPE &rArr; SYSTEM_TIME_TYPE  &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 345 </font></span><font color="#ff00cc">      'a STATE_scheme &times; MSG_SZ_TYPE option &times; RETURN_CODE_TYPE option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 346 </font></span>  <font color="#ff00cc">&quot;RECEIVE_BUFFER s core_id buf_id tout = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 347 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 348 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 349 </font></span><font color="#ff00cc">     if getBufAttrByID s (the cur_part_id,buf_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 350 </font></span><font color="#ff00cc">          (s , None , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 351 </font></span><font color="#ff00cc">     else if (nat tout) &gt; INVALID_TIMEOUT_VALUE  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 352 </font></span><font color="#ff00cc">          (s , None , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 353 </font></span><font color="#ff00cc">     else if &not; bufEmpty s (the cur_part_id,buf_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 354 </font></span><font color="#ff00cc">             let sRemovFst_msg = removeFstMsg s (the cur_part_id,buf_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 355 </font></span><font color="#ff00cc">                mlength = MSG_SZ (the (snd sRemovFst_msg)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 356 </font></span><font color="#ff00cc">              if &not; rscProcQueEmpty s (buf (the cur_part_id,buf_id)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 357 </font></span><font color="#ff00cc">                  let s_pt_rmvPid= rscQPop (fst sRemovFst_msg) (buf (the cur_part_id,buf_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 358 </font></span><font color="#ff00cc">                      sendProcCntxt = getCntxt (fst s_pt_rmvPid) (the (snd s_pt_rmvPid));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 359 </font></span><font color="#ff00cc">                      sendMsg = getSendbufCntxtMsg (the sendProcCntxt);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 360 </font></span><font color="#ff00cc">                      s_insertBufM = insertBufMsg (fst s_pt_rmvPid) (the cur_part_id,buf_id) sendMsg ;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 361 </font></span><font color="#ff00cc">                      s_stopTimeCt =  StopTCounter s_insertBufM (the (snd s_pt_rmvPid));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 362 </font></span><font color="#ff00cc">                      s_setToReady =  if &not;isSuspended s_stopTimeCt (the (snd s_pt_rmvPid)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 363 </font></span><font color="#ff00cc">                                        procReady s_stopTimeCt (the (snd s_pt_rmvPid))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 364 </font></span><font color="#ff00cc">                                    else  s_stopTimeCt in  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 365 </font></span><font color="#ff00cc">                  (schedule_Abs s_setToReady core_id , Some mlength , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 366 </font></span><font color="#ff00cc">               else ((fst sRemovFst_msg) , Some mlength , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 367 </font></span><font color="#ff00cc">     else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 368 </font></span><font color="#ff00cc">            (s , Some 0 , Some NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 369 </font></span><font color="#ff00cc">     else if getProcUserPLMtx s (the cur_part_id,the cur_proc_id) &ne; None &or; (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 370 </font></span><font color="#ff00cc">            (s , Some 0 , Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 371 </font></span><font color="#ff00cc">     else if tout = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 372 </font></span><font color="#ff00cc">             let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 373 </font></span><font color="#ff00cc">                 s_insertBufQue = rscQPush s_setWaiting (buf (the cur_part_id,buf_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 374 </font></span><font color="#ff00cc">                 s_setWd = setWaitDiff s_insertBufQue (the cur_part_id,the cur_proc_id) tout in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 375 </font></span><font color="#ff00cc">             (schedule_Abs s_setWd core_id , None , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 376 </font></span><font color="#ff00cc">     else  let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 377 </font></span><font color="#ff00cc">               s_insertBufQue = rscQPush s_setWaiting (buf (the cur_part_id,buf_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 378 </font></span><font color="#ff00cc">               s_setWaitDiff = setWaitDiff s_insertBufQue (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 379 </font></span><font color="#ff00cc">               s_waitAddTimeQ = waitAdd_D s_setWaitDiff  (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 380 </font></span><font color="#ff00cc">               s_setTCtrRsc = setCterRsc s_waitAddTimeQ (the cur_part_id,the cur_proc_id) (Int.int(timer_' s_waitAddTimeQ) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 381 </font></span><font color="#ff00cc">               s_setCntxt = setCntxt s_setTCtrRsc (the cur_part_id,the cur_proc_id) (recvBuf ((the cur_part_id,buf_id), None)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 382 </font></span><font color="#ff00cc">           (schedule_Abs s_setCntxt core_id , None , None)       </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 383 </font></span><font color="#ff00cc">          </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 384 </font></span><font color="#ff00cc">  )&quot;</font>             
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 385 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 386 </font></span><font color="#006699"><strong>definition</strong></font> RECEIVE_BUFFER' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 387 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE  &rArr; 'a STATE_scheme &times; temp_Message option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 388 </font></span>  <font color="#ff00cc">&quot;RECEIVE_BUFFER' s core_id  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 389 </font></span><font color="#ff00cc">  (let cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 390 </font></span><font color="#ff00cc">       cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 391 </font></span><font color="#ff00cc">       t_getCterRsc = getCterRsc s (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 392 </font></span><font color="#ff00cc">       ctx = getRecvBufCtxt(the (getCntxt s (the cur_part_id,the cur_proc_id))) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 393 </font></span><font color="#ff00cc">    if (the t_getCterRsc) &lt;= Int.int(timer_' s) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 394 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id), snd ( ctx), TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 395 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 396 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id), snd ( ctx), NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 397 </font></span><font color="#ff00cc">   )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 398 </font></span>                                      
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 399 </font></span><font color="#006699"><strong>definition</strong></font> GET_BUFFER_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 400 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BUFFER_NAME_TYPE  &rArr; 'a STATE_scheme &times; BUFFER_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 401 </font></span>  <font color="#ff00cc">&quot;GET_BUFFER_ID s core_id buffer_name =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 402 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 403 </font></span><font color="#ff00cc">        buf_id_op = getBufIDByName s (the cur_part_id) buffer_name in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 404 </font></span><font color="#ff00cc">     if buf_id_op = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 405 </font></span><font color="#ff00cc">         (s , None,INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 406 </font></span><font color="#ff00cc">      else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 407 </font></span><font color="#ff00cc">         (s, buf_id_op, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 408 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 409 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 410 </font></span><font color="#006699"><strong>definition</strong></font> GET_BUFFER_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 411 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BUFFER_ID_TYPE &rArr; 'a STATE_scheme &times; BUFFER_STATUS_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 412 </font></span>  <font color="#ff00cc">&quot;GET_BUFFER_STATUS s core_id buf_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 413 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 414 </font></span><font color="#ff00cc">      if getBufAttrByID s (the cur_part_id,buf_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 415 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 416 </font></span><font color="#ff00cc">      else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 417 </font></span><font color="#ff00cc">        (s , Some (getBufStatus s core_id (the cur_part_id,buf_id)), NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 418 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 419 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 420 </font></span><font color="#006699"><strong>section</strong></font> <font color="#6600cc">&lsaquo;</font><font color="#6600cc"> </font><font color="#6600cc">B</font><font color="#6600cc">l</font><font color="#6600cc">a</font><font color="#6600cc">c</font><font color="#6600cc">k</font><font color="#6600cc">b</font><font color="#6600cc">o</font><font color="#6600cc">a</font><font color="#6600cc">r</font><font color="#6600cc">d</font><font color="#6600cc"> </font><font color="#6600cc">S</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc">v</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">e</font><font color="#6600cc">s</font><font color="#6600cc"> </font><font color="#6600cc"> </font><font color="#6600cc">&rsaquo;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 421 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 422 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_BLACKBOARD<font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 423 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BLACKBD_ATTR_TYPE &rArr; ('a STATE_scheme &times; BLACKBD_ID_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 424 </font></span>  <font color="#ff00cc">&quot;CREATE_BLACKBOARD s core_id bbd_attr = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 425 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 426 </font></span><font color="#ff00cc">      blackbdName = BLACKBD_NAME bbd_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 427 </font></span><font color="#ff00cc">      mag_sz = BLACKBD_ATTR_TYPE.MAX_MSG_SZ bbd_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 428 </font></span><font color="#ff00cc">      created_bbds = size_set (getBbdsOfPart s (the cur_part_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 429 </font></span><font color="#ff00cc">   if created_bbds &ge;  MAX_NUM_OF_BBDS then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 430 </font></span><font color="#ff00cc">        (s , None , INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 431 </font></span><font color="#ff00cc">   else if getBbdIDByName s (the cur_part_id) blackbdName &ne; None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 432 </font></span><font color="#ff00cc">        (s , None , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 433 </font></span><font color="#ff00cc">   else if mag_sz = 0 &or; mag_sz &lt; 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 434 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 435 </font></span><font color="#ff00cc">   else if getPartMode s (the cur_part_id) = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 436 </font></span><font color="#ff00cc">        (s , None , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 437 </font></span><font color="#ff00cc">   else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 438 </font></span><font color="#ff00cc">        (let blackbd_id = newBlackbdID s (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 439 </font></span><font color="#ff00cc">            s_new = createBlackbd s (the cur_part_id) blackbd_id bbd_attr in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 440 </font></span><font color="#ff00cc">          (s_new , Some blackbd_id , NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 441 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 442 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 443 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 444 </font></span><font color="#006699"><strong>definition</strong></font> DISPLAY_BLACKBOARD <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 445 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BLACKBD_ID_TYPE  &rArr; Message &rArr; ('a STATE_scheme  &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 446 </font></span>  <font color="#ff00cc">&quot;DISPLAY_BLACKBOARD s core_id bbd_id msg = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 447 </font></span><font color="#ff00cc">    (let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 448 </font></span><font color="#ff00cc">    if getBbdAttrByID s (the cur_part_id,bbd_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 449 </font></span><font color="#ff00cc">       (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 450 </font></span><font color="#ff00cc">    else if msg &gt; getBbdMaxMsgSz s (the cur_part_id,bbd_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 451 </font></span><font color="#ff00cc">       (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 452 </font></span><font color="#ff00cc">    else if msg = 0 &or; msg &lt; 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 453 </font></span><font color="#ff00cc">       (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 454 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 455 </font></span><font color="#ff00cc">       let s_setOccip = setEmptyId s (the cur_part_id,bbd_id) OCCUPIED;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 456 </font></span><font color="#ff00cc">           s_owrtBbdMsg = owrtBbdMsg s_setOccip (the cur_part_id,bbd_id) msg in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 457 </font></span><font color="#ff00cc">           if rscProcQueEmpty s (bbd (the cur_part_id,bbd_id)) then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 458 </font></span><font color="#ff00cc">               let pendingProcs = getRscQueList s_owrtBbdMsg (bbd (the cur_part_id,bbd_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 459 </font></span><font color="#ff00cc">                   s_stopQuetCtr = stopProcLTCtr s_owrtBbdMsg (the pendingProcs);                   </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 460 </font></span><font color="#ff00cc">                   s_clearPendProcs = clearPendProcs s_stopQuetCtr (bbd (the cur_part_id,bbd_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 461 </font></span><font color="#ff00cc">                   s_setReady = procsReady s_clearPendProcs (the cur_part_id) (getProcList (the pendingProcs)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 462 </font></span><font color="#ff00cc">               (schedule_Abs s_setReady core_id ,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 463 </font></span><font color="#ff00cc">           else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 464 </font></span><font color="#ff00cc">               (s_owrtBbdMsg,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 465 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 466 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 467 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 468 </font></span><font color="#006699"><strong>definition</strong></font> READ_BLACKBOARD <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 469 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BLACKBD_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; ('a STATE_scheme &times; Message option &times; RETURN_CODE_TYPE option)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 470 </font></span>  <font color="#ff00cc">&quot;READ_BLACKBOARD s core_id bbd_id tout =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 471 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 472 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 473 </font></span><font color="#ff00cc">    if getBbdAttrByID s (the cur_part_id,bbd_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 474 </font></span><font color="#ff00cc">        (s ,None, Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 475 </font></span><font color="#ff00cc">    else if (nat tout) &gt; INVALID_TIMEOUT_VALUE  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 476 </font></span><font color="#ff00cc">        (s ,None, Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 477 </font></span><font color="#ff00cc">    else if emptyID(blackBD_' s)(the cur_part_id,bbd_id) = Some OCCUPIED then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 478 </font></span><font color="#ff00cc">           let msg = the(readBbdMsg s (the cur_part_id,bbd_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 479 </font></span><font color="#ff00cc">              mlength = MSG_SZ msg in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 480 </font></span><font color="#ff00cc">          (s ,Some mlength ,Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 481 </font></span><font color="#ff00cc">    else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 482 </font></span><font color="#ff00cc">          (s , Some 0 ,Some NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 483 </font></span><font color="#ff00cc">    else if getProcUserPLMtx s (the cur_part_id,the cur_proc_id) &ne; None &or; (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 484 </font></span><font color="#ff00cc">          (s , Some 0 ,Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 485 </font></span><font color="#ff00cc">    else if tout = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 486 </font></span><font color="#ff00cc">           let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 487 </font></span><font color="#ff00cc">              s_insertQue = rscQPush s_setWaiting (bbd (the cur_part_id,bbd_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 488 </font></span><font color="#ff00cc">              s_setWd = setWaitDiff s_insertQue (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 489 </font></span><font color="#ff00cc">              s_setCntxt = setCntxt s_setWd (the cur_part_id,the cur_proc_id) (rdBbd (the cur_part_id,bbd_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 490 </font></span><font color="#ff00cc">          (schedule_Abs s_setCntxt core_id , None , None)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 491 </font></span><font color="#ff00cc">    else let s_setWaiting = setProcSta s (the cur_part_id, the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 492 </font></span><font color="#ff00cc">              s_insertQue = rscQPush s_setWaiting (bbd (the cur_part_id,bbd_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 493 </font></span><font color="#ff00cc">              s_setTimeCtr = setAddWaitDiff s_insertQue (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 494 </font></span><font color="#ff00cc">              s_setTCtrRsc = setCterRsc s_setTimeCtr (the cur_part_id,the cur_proc_id) (Int.int(timer_' s_setTimeCtr) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 495 </font></span><font color="#ff00cc">              s_setCntxt = setCntxt s_setTCtrRsc (the cur_part_id,the cur_proc_id) (rdBbd (the cur_part_id,bbd_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 496 </font></span><font color="#ff00cc">          (schedule_Abs s_setCntxt core_id , None , None)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 497 </font></span><font color="#ff00cc">        </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 498 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 499 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 500 </font></span><font color="#006699"><strong>definition</strong></font> READ_BLACKBOARD' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 501 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr;V_CORE_ID_TYPE &rArr; ('a STATE_scheme &times; MSG_SZ_TYPE  &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 502 </font></span>  <font color="#ff00cc">&quot;READ_BLACKBOARD' s core_id  = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 503 </font></span><font color="#ff00cc">  (let cur_proc_id = the(curProcID_Core s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 504 </font></span><font color="#ff00cc">      cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 505 </font></span><font color="#ff00cc">      t_waitDiff = the(getWaitDiff s (cur_part_id,cur_proc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 506 </font></span><font color="#ff00cc">      Cntxt = the(getCntxt s (cur_part_id,cur_proc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 507 </font></span><font color="#ff00cc">      bbd_id = getRdBbdCntxtBbdID Cntxt;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 508 </font></span><font color="#ff00cc">      t_getCterRsc = getCterRsc s (cur_part_id,cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 509 </font></span><font color="#ff00cc">    if t_waitDiff = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 510 </font></span><font color="#ff00cc">         let msg = the(readBbdMsg s (cur_part_id,bbd_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 511 </font></span><font color="#ff00cc">             mlength = MSG_SZ msg in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 512 </font></span><font color="#ff00cc">        (resetCntxt s (cur_part_id,cur_proc_id), mlength , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 513 </font></span><font color="#ff00cc">    else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 514 </font></span><font color="#ff00cc">        if the t_getCterRsc  &lt;= Int.int(timer_' s) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 515 </font></span><font color="#ff00cc">           (resetCntxt s (cur_part_id,cur_proc_id) ,0 , TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 516 </font></span><font color="#ff00cc">        else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 517 </font></span><font color="#ff00cc">           let mes = the(readBbdMsg s (cur_part_id,bbd_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 518 </font></span><font color="#ff00cc">               mlength = MSG_SZ mes in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 519 </font></span><font color="#ff00cc">           (resetCntxt s (cur_part_id,cur_proc_id), mlength , NO_ERROR)        </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 520 </font></span><font color="#ff00cc">   )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 521 </font></span>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 522 </font></span><font color="#006699"><strong>definition</strong></font> CLEAR_BLACKBOARD <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 523 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BLACKBD_ID_TYPE &rArr; ('a STATE_scheme  &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 524 </font></span>  <font color="#ff00cc">&quot;CLEAR_BLACKBOARD s core_id bbd_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 525 </font></span><font color="#ff00cc">  (let  cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 526 </font></span><font color="#ff00cc">    s_setEmptyId = setEmptyId s (the cur_part_id,bbd_id) EMPTY;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 527 </font></span><font color="#ff00cc">    s_clearBbdMsg =  clearBbdMsg s_setEmptyId (the cur_part_id,bbd_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 528 </font></span><font color="#ff00cc">  if getBbdAttrByID s (the cur_part_id,bbd_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 529 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 530 </font></span><font color="#ff00cc">  else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 531 </font></span><font color="#ff00cc">      (s_clearBbdMsg , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 532 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 533 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 534 </font></span><font color="#006699"><strong>definition</strong></font> GET_BLACKBOARD_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 535 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BLACKBD_NAME_TYPE &rArr; ('a STATE_scheme &times; BLACKBD_ID_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 536 </font></span>  <font color="#ff00cc">&quot;GET_BLACKBOARD_ID s core_id bbd_name  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 537 </font></span><font color="#ff00cc">  (let  cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 538 </font></span><font color="#ff00cc">        bbd_id_op = getBbdIDByName s (the cur_part_id) bbd_name in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 539 </font></span><font color="#ff00cc">   if bbd_id_op = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 540 </font></span><font color="#ff00cc">      (s , None,INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 541 </font></span><font color="#ff00cc">   else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 542 </font></span><font color="#ff00cc">      (s, bbd_id_op,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 543 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 544 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 545 </font></span><font color="#006699"><strong>definition</strong></font> GET_BLACKBOARD_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 546 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; BLACKBD_ID_TYPE &rArr; ('a STATE_scheme &times; BLACKBD_STATUS_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 547 </font></span>  <font color="#ff00cc">&quot;GET_BLACKBOARD_STATUS s core_id bbd_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 548 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 549 </font></span><font color="#ff00cc">  if getBbdAttrByID s (the cur_part_id,bbd_id) = None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 550 </font></span><font color="#ff00cc">      (s, None ,INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 551 </font></span><font color="#ff00cc">  else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 552 </font></span><font color="#ff00cc">      (s , Some (getBbdStatus s (the cur_part_id,bbd_id)) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 553 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 554 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 555 </font></span><font color="#006699"><strong>section</strong></font> <font color="#6600cc">&lsaquo;</font><font color="#6600cc"> </font><font color="#6600cc">S</font><font color="#6600cc">e</font><font color="#6600cc">m</font><font color="#6600cc">a</font><font color="#6600cc">p</font><font color="#6600cc">h</font><font color="#6600cc">o</font><font color="#6600cc">r</font><font color="#6600cc">e</font><font color="#6600cc"> </font><font color="#6600cc">S</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc">v</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">e</font><font color="#6600cc">s</font><font color="#6600cc"> </font><font color="#6600cc">&rsaquo;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 556 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 557 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_SEMAPHORE <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 558 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; USER_SEMA_ATTR_TYPE &rArr; ('a STATE_scheme &times; SEMA_ID_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 559 </font></span>  <font color="#ff00cc">&quot;CREATE_SEMAPHORE s core_id userMtx_attr = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 560 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 561 </font></span><font color="#ff00cc">      sema_name = USER_SEMA_ATTR_TYPE.SEMA_NAME userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 562 </font></span><font color="#ff00cc">      curVal = USER_SEMA_ATTR_TYPE.CUR_VALUE userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 563 </font></span><font color="#ff00cc">      MaxNVal = USER_SEMA_ATTR_TYPE.MAX_VALUE userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 564 </font></span><font color="#ff00cc">      que_discip = USER_SEMA_ATTR_TYPE.QUE_DISCIPLINE userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 565 </font></span><font color="#ff00cc">      created_semas = size_set (getUserSemasOfPart s (the cur_part_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 566 </font></span><font color="#ff00cc">    if  created_semas &ge; MAX_NUM_OF_SEMA then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 567 </font></span><font color="#ff00cc">        (s , None , INVALID_CONFIG )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 568 </font></span><font color="#ff00cc">    else if getUserSemaIDByName s (the cur_part_id) sema_name &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 569 </font></span><font color="#ff00cc">        (s , None , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 570 </font></span><font color="#ff00cc">    else if curVal &gt;  MAX_SEMA_VALUE &or; curVal &lt; 0  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 571 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 572 </font></span><font color="#ff00cc">    else if  MaxNVal &gt; MAX_SEMA_VALUE &or; MaxNVal &lt;0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 573 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 574 </font></span><font color="#ff00cc">    else if curVal &gt; MaxNVal then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 575 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 576 </font></span><font color="#ff00cc">    else if getPartMode s (the cur_part_id) = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 577 </font></span><font color="#ff00cc">        (s , None , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 578 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 579 </font></span><font color="#ff00cc">        (let sema_id = newSemaID s (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 580 </font></span><font color="#ff00cc">            s_new = createUserSema s (the cur_part_id)  sema_id userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 581 </font></span><font color="#ff00cc">            s_initSema = initSema s_new (the cur_part_id,sema_id) curVal MaxNVal in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 582 </font></span><font color="#ff00cc">          (s_initSema ,Some sema_id , NO_ERROR)           </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 583 </font></span><font color="#ff00cc">        )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 584 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 585 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 586 </font></span><font color="#006699"><strong>definition</strong></font> WAIT_SEMAPHORE <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 587 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; SEMA_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; ('a STATE_scheme &times; RETURN_CODE_TYPE option)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 588 </font></span>  <font color="#ff00cc">&quot;WAIT_SEMAPHORE s core_id sema_id tout = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 589 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 590 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 591 </font></span><font color="#ff00cc">    if  getUserSemaAttrByID s (the cur_part_id,sema_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 592 </font></span><font color="#ff00cc">        (s , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 593 </font></span><font color="#ff00cc">    else if (nat tout) &gt; INVALID_TIMEOUT_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 594 </font></span><font color="#ff00cc">        (s , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 595 </font></span><font color="#ff00cc">    else if (the (curValue(sema_' s)(the cur_part_id,sema_id))) &gt; 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 596 </font></span><font color="#ff00cc">        (subSemaCurVal s (the cur_part_id,sema_id) ,Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 597 </font></span><font color="#ff00cc">    else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 598 </font></span><font color="#ff00cc">        (s , Some NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 599 </font></span><font color="#ff00cc">    else if getProcUserPLMtx s (the cur_part_id,the cur_proc_id) &ne; None &or; (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 600 </font></span><font color="#ff00cc">        (s , Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 601 </font></span><font color="#ff00cc">    else if tout = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 602 </font></span><font color="#ff00cc">        (let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 603 </font></span><font color="#ff00cc">            s_insertQue = rscQPush s_setWaiting (sema (the cur_part_id,sema_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 604 </font></span><font color="#ff00cc">            s_infiniteWd = setWaitDiff s_insertQue (the cur_part_id,the cur_proc_id) tout in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 605 </font></span><font color="#ff00cc">         (schedule_Abs s_infiniteWd core_id , Some NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 606 </font></span><font color="#ff00cc">    else (let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 607 </font></span><font color="#ff00cc">            s_insertQue = rscQPush s_setWaiting (sema (the cur_part_id,sema_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 608 </font></span><font color="#ff00cc">            s_setTimeCtr = setAddWaitDiff s_insertQue (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 609 </font></span><font color="#ff00cc">            s_setTCtrRsc = setCterRsc s_setTimeCtr (the cur_part_id,the cur_proc_id) (Int.int(timer_' s_setTimeCtr) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 610 </font></span><font color="#ff00cc">            s_setCntxt = setCntxt s_setTCtrRsc (the cur_part_id,the cur_proc_id) (waitSema (the cur_part_id,sema_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 611 </font></span><font color="#ff00cc">          (schedule_Abs s_setCntxt core_id, None))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 612 </font></span><font color="#ff00cc">    )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 613 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 614 </font></span><font color="#006699"><strong>definition</strong></font> WAIT_SEMAPHORE' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 615 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; ('a STATE_scheme &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 616 </font></span>  <font color="#ff00cc">&quot;WAIT_SEMAPHORE' s core_id  = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 617 </font></span><font color="#ff00cc">  (let  cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 618 </font></span><font color="#ff00cc">        cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 619 </font></span><font color="#ff00cc">       t_getCterRsc = getCterRsc s (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 620 </font></span><font color="#ff00cc">    if the t_getCterRsc  &lt;= Int.int(timer_' s) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 621 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id)  , TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 622 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 623 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id)  , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 624 </font></span><font color="#ff00cc">   )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 625 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 626 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 627 </font></span><font color="#006699"><strong>definition</strong></font> SIGNAL_SEMAPHORE <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 628 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; SEMA_ID_TYPE  &rArr; ('a STATE_scheme &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 629 </font></span>  <font color="#ff00cc">&quot;SIGNAL_SEMAPHORE s core_id sema_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 630 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 631 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 632 </font></span><font color="#ff00cc">    if  getUserSemaAttrByID s (the cur_part_id,sema_id) = None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 633 </font></span><font color="#ff00cc">        (s ,  INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 634 </font></span><font color="#ff00cc">    else if the (curValue(sema_' s)(the cur_part_id,sema_id)) = the (maxValue(sema_' s)(the cur_part_id,sema_id)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 635 </font></span><font color="#ff00cc">        (s , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 636 </font></span><font color="#ff00cc">    else if rscProcQueEmpty s (sema (the cur_part_id,sema_id))  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 637 </font></span><font color="#ff00cc">        (addSemaCurVal s (the cur_part_id,sema_id) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 638 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 639 </font></span><font color="#ff00cc">         let s_pt_recHeadProcID = rscQPop s (sema (the cur_part_id,sema_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 640 </font></span><font color="#ff00cc">            s_stopTimeCt = StopTCounter (fst s_pt_recHeadProcID) (the (snd s_pt_recHeadProcID));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 641 </font></span><font color="#ff00cc">            s_setToReady = if &not;isSuspended s_stopTimeCt (the (snd s_pt_recHeadProcID)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 642 </font></span><font color="#ff00cc">                              procReady s_stopTimeCt (the (snd s_pt_recHeadProcID))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 643 </font></span><font color="#ff00cc">                           else  s_stopTimeCt in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 644 </font></span><font color="#ff00cc">          (schedule_Abs s_setToReady core_id , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 645 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 646 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 647 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 648 </font></span><font color="#006699"><strong>definition</strong></font> GET_SEMAPHORE_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 649 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; V_CORE_ID_TYPE &rArr; SEMA_NAME_TYPE  &rArr; ('a STATE_scheme &times; SEMA_ID_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 650 </font></span>  <font color="#ff00cc">&quot;GET_SEMAPHORE_ID s core_id sema_name = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 651 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 652 </font></span><font color="#ff00cc">        sema_id_op = getUserSemaIDByName s (the cur_part_id) sema_name in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 653 </font></span><font color="#ff00cc">    if sema_id_op = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 654 </font></span><font color="#ff00cc">      (s , None ,INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 655 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 656 </font></span><font color="#ff00cc">      (s, sema_id_op, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 657 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 658 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 659 </font></span><font color="#006699"><strong>definition</strong></font> GET_SEMAPHORE_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 660 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; SEMA_ID_TYPE &rArr; ('a STATE_scheme &times; USER_SEMA_STATUS_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 661 </font></span>  <font color="#ff00cc">&quot;GET_SEMAPHORE_STATUS s core_id sema_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 662 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 663 </font></span><font color="#ff00cc">    if getUserSemaAttrByID s (the cur_part_id,sema_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 664 </font></span><font color="#ff00cc">      (s , None , INVALID_PARAM )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 665 </font></span><font color="#ff00cc">    else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 666 </font></span><font color="#ff00cc">      (s , Some (getSemaStatus s (the cur_part_id,sema_id)) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 667 </font></span><font color="#ff00cc">   )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 668 </font></span><font color="#cc0000">(*End Semaphore Services *)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 669 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 670 </font></span><font color="#006699"><strong>section</strong></font> <font color="#6600cc">&lsaquo;</font><font color="#6600cc"> </font><font color="#6600cc">S</font><font color="#6600cc">t</font><font color="#6600cc">a</font><font color="#6600cc">r</font><font color="#6600cc">t</font><font color="#6600cc"> </font><font color="#6600cc">E</font><font color="#6600cc">V</font><font color="#6600cc">E</font><font color="#6600cc">N</font><font color="#6600cc">T</font><font color="#6600cc"> </font><font color="#6600cc">&rsaquo;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 671 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 672 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_EVENT <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 673 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; EVENT_NAME_TYPE &rArr; ('a STATE_scheme &times; EVENT_ID_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 674 </font></span>  <font color="#ff00cc">&quot;CREATE_EVENT s core_id event_name =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 675 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 676 </font></span><font color="#ff00cc">      created_evts = size_set (getEvntsOfPart s (the cur_part_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 677 </font></span><font color="#ff00cc">    if  created_evts &ge; MAX_NUM_OF_EVENTS  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 678 </font></span><font color="#ff00cc">        (s , None , INVALID_CONFIG )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 679 </font></span><font color="#ff00cc">    else if getEvtIDByName s (the cur_part_id) event_name &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 680 </font></span><font color="#ff00cc">        (s , None , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 681 </font></span><font color="#ff00cc">    else if getPartMode s (the cur_part_id) = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 682 </font></span><font color="#ff00cc">        (s , None , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 683 </font></span><font color="#ff00cc">    else let event_id = newEventID s (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 684 </font></span><font color="#ff00cc">            s_new = createEvent s core_id (the cur_part_id) event_id event_name;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 685 </font></span><font color="#ff00cc">            s_setEventSta = setEventSta s_new (the cur_part_id,event_id) DOWN in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 686 </font></span><font color="#ff00cc">          (s_setEventSta ,Some event_id, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 687 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 688 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 689 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 690 </font></span><font color="#006699"><strong>definition</strong></font> SET_EVENT <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 691 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE  &rArr; EVENT_ID_TYPE &rArr; ('a STATE_scheme &times; RETURN_CODE_TYPE) &quot;</font> <font color="#009966"><strong>where</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 692 </font></span>  <font color="#ff00cc">&quot;SET_EVENT s core_id evt_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 693 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 694 </font></span><font color="#ff00cc">    if getEvtAttrByID s (the cur_part_id,evt_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 695 </font></span><font color="#ff00cc">        (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 696 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 697 </font></span><font color="#ff00cc">         let s_setEvtSta = setEventSta s (the cur_part_id,evt_id) UP in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 698 </font></span><font color="#ff00cc">          if rscProcQueEmpty s_setEvtSta (evt (the cur_part_id,evt_id)) &ne; True then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 699 </font></span><font color="#ff00cc">             let pendingProcs = getRscQueList s_setEvtSta (evt (the cur_part_id,evt_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 700 </font></span><font color="#ff00cc">                 s_delTctrs = stopProcLTCtr s_setEvtSta (the pendingProcs);                 </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 701 </font></span><font color="#ff00cc">                 s_delRscQueProcs = clearPendProcs s_delTctrs (evt (the cur_part_id,evt_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 702 </font></span><font color="#ff00cc">                 s_setReady = procsReady s_delRscQueProcs (the cur_part_id) (getProcList (the pendingProcs)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 703 </font></span><font color="#ff00cc">               (schedule_Abs s_setReady core_id , NO_ERROR) </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 704 </font></span><font color="#ff00cc">           else (s_setEvtSta , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 705 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 706 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 707 </font></span><font color="#006699"><strong>definition</strong></font> RESET_EVENT <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 708 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; EVENT_ID_TYPE &rArr; ('a STATE_scheme &times; RETURN_CODE_TYPE) &quot;</font> <font color="#009966"><strong>where</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 709 </font></span>  <font color="#ff00cc">&quot;RESET_EVENT s core_id evt_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 710 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 711 </font></span><font color="#ff00cc">    if getEvtAttrByID s (the cur_part_id,evt_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 712 </font></span><font color="#ff00cc">        (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 713 </font></span><font color="#ff00cc">    else (setEventSta s (the cur_part_id,evt_id) DOWN , NO_ERROR )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 714 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 715 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 716 </font></span><font color="#006699"><strong>definition</strong></font> WAIT_EVENT <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 717 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; EVENT_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; ('a STATE_scheme &times; RETURN_CODE_TYPE) &quot;</font> <font color="#009966"><strong>where</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 718 </font></span>  <font color="#ff00cc">&quot;WAIT_EVENT s core_id evt_id tout =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 719 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 720 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 721 </font></span><font color="#ff00cc">    if getEvtAttrByID s (the cur_part_id,evt_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 722 </font></span><font color="#ff00cc">        (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 723 </font></span><font color="#ff00cc">    else if (nat tout) &gt; INVALID_TIMEOUT_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 724 </font></span><font color="#ff00cc">        (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 725 </font></span><font color="#ff00cc">    else if the (eventSta(event_' s)(the cur_part_id,evt_id)) = UP then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 726 </font></span><font color="#ff00cc">        (s , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 727 </font></span><font color="#ff00cc">    else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 728 </font></span><font color="#ff00cc">        (s , NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 729 </font></span><font color="#ff00cc">    else if (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 730 </font></span><font color="#ff00cc">        (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 731 </font></span><font color="#ff00cc">    else if tout = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 732 </font></span><font color="#ff00cc">         let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 733 </font></span><font color="#ff00cc">            s_insertQue = rscQPush s_setWaiting (evt (the cur_part_id,evt_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 734 </font></span><font color="#ff00cc">            s_infiniteWd = setWaitDiff s_insertQue (the cur_part_id,the cur_proc_id) tout in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 735 </font></span><font color="#ff00cc">          (schedule_Abs s_infiniteWd core_id , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 736 </font></span><font color="#ff00cc">    else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 737 </font></span><font color="#ff00cc">         let s_setWaiting = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 738 </font></span><font color="#ff00cc">            s_insertQue = rscQPush s_setWaiting (evt (the cur_part_id,evt_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 739 </font></span><font color="#ff00cc">            s_setTimeCtr = setAddWaitDiff s_insertQue (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 740 </font></span><font color="#ff00cc">            s_setTCtrRsc = setCterRsc s_setTimeCtr (the cur_part_id,the cur_proc_id) (Int.int(timer_' s_setTimeCtr) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 741 </font></span><font color="#ff00cc">            s_setCntxt = setCntxt s_setTCtrRsc (the cur_part_id,the cur_proc_id) (waitEvt (the cur_part_id,evt_id))  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 742 </font></span><font color="#ff00cc">          (schedule_Abs s_setCntxt core_id , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 743 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 744 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 745 </font></span><font color="#006699"><strong>definition</strong></font> WAIT_EVENT' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 746 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; ('a STATE_scheme &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 747 </font></span>  <font color="#ff00cc">&quot;WAIT_EVENT' s core_id  = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 748 </font></span><font color="#ff00cc">  (let  cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 749 </font></span><font color="#ff00cc">        cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 750 </font></span><font color="#ff00cc">      t_getCterRsc = getCterRsc s (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 751 </font></span><font color="#ff00cc">    if the t_getCterRsc &lt;= Int.int(timer_' s)  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 752 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id)  , TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 753 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 754 </font></span><font color="#ff00cc">      (resetCntxt s (the cur_part_id,the cur_proc_id)  , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 755 </font></span><font color="#ff00cc">   )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 756 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 757 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 758 </font></span><font color="#006699"><strong>definition</strong></font> GET_EVENT_ID  <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 759 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; V_CORE_ID_TYPE &rArr; EVENT_NAME_TYPE  &rArr; ('a STATE_scheme &times; EVENT_ID_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 760 </font></span>  <font color="#ff00cc">&quot;GET_EVENT_ID  s core_id evt_name = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 761 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 762 </font></span><font color="#ff00cc">    if getEvtIDByName s (the cur_part_id) evt_name = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 763 </font></span><font color="#ff00cc">      (s , None ,INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 764 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 765 </font></span><font color="#ff00cc">      (s, Some (the(getEvtIDByName s (the cur_part_id) evt_name)) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 766 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 767 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 768 </font></span><font color="#006699"><strong>definition</strong></font> GET_EVENT_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 769 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; EVENT_ID_TYPE  &rArr; ('a STATE_scheme &times; EVENT_STATUS_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 770 </font></span>  <font color="#ff00cc">&quot;GET_EVENT_STATUS s core_id evt_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 771 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 772 </font></span><font color="#ff00cc">    if getEvtAttrByID s (the cur_part_id,evt_id) = None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 773 </font></span><font color="#ff00cc">      (s , None , INVALID_PARAM )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 774 </font></span><font color="#ff00cc">    else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 775 </font></span><font color="#ff00cc">      (s , Some (getEvtStatus s (the cur_part_id,evt_id)) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 776 </font></span><font color="#ff00cc">   )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 777 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 778 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 779 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_MUTEX <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 780 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; USER_PL_MUTEX_ATTR_TYPE &rArr; ('a STATE_scheme &times; USER_PL_MUTEX_ID_TYPE option &times; RETURN_CODE_TYPE)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 781 </font></span>  <font color="#ff00cc">&quot;CREATE_MUTEX s core_id userMtx_attr =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 782 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 783 </font></span><font color="#ff00cc">      umutex_name = USER_PL_MUTEX_ATTR_TYPE.MUTEX_NAME userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 784 </font></span><font color="#ff00cc">      prio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 785 </font></span><font color="#ff00cc">      que_disc = USER_PL_MUTEX_ATTR_TYPE.QUE_DISCIPLINE userMtx_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 786 </font></span><font color="#ff00cc">      created_mtxs = size_set (getUserPLMtxsOfPart s (the cur_part_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 787 </font></span><font color="#ff00cc">    if created_mtxs &ge; MAX_NUM_OF_MUTEXES  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 788 </font></span><font color="#ff00cc">        (s , None , INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 789 </font></span><font color="#ff00cc">    else if getBufIDByName s (the cur_part_id) umutex_name &ne; None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 790 </font></span><font color="#ff00cc">        (s , None , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 791 </font></span><font color="#ff00cc">    else if prio &gt; MAX_PRIORITY_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 792 </font></span><font color="#ff00cc">        (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 793 </font></span><font color="#ff00cc">    else if  the(curMode(partitions_' s)(the cur_part_id)) = NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 794 </font></span><font color="#ff00cc">        (s , None , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 795 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 796 </font></span><font color="#ff00cc">        (let umtx_id =  newUserMutexID s (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 797 </font></span><font color="#ff00cc">            s_new = createUserMutex s (the cur_part_id) umtx_id userMtx_attr in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 798 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 799 </font></span><font color="#ff00cc">        (s_new , Some umtx_id , NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 800 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 801 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 802 </font></span><font color="#006699"><strong>definition</strong></font> ACQUIRE_MUTEX <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 803 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; USER_PL_MUTEX_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; 'a STATE_scheme  &times; RETURN_CODE_TYPE option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 804 </font></span>  <font color="#ff00cc">&quot;ACQUIRE_MUTEX s core_id mtx_id tout =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 805 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 806 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 807 </font></span><font color="#ff00cc">      mtx_attr_op = getUserPLMtxAttrByID s (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 808 </font></span><font color="#ff00cc">      mtxPrio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY(the mtx_attr_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 809 </font></span><font color="#ff00cc">      procPrio = the(getPriority s (the cur_part_id,the cur_proc_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 810 </font></span><font color="#ff00cc">    if mtx_attr_op = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 811 </font></span><font color="#ff00cc">        (s  , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 812 </font></span><font color="#ff00cc">    else if mtx_id = PREEMPT_MUTEX_ID_TYPE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 813 </font></span><font color="#ff00cc">        (s , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 814 </font></span><font color="#ff00cc">    else if nat tout &gt; INVALID_TIMEOUT_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 815 </font></span><font color="#ff00cc">        (s , Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 816 </font></span><font color="#ff00cc">    else if (getProcUserPLMtx s (the cur_part_id,the cur_proc_id) &ne; None &and; the(getProcUserPLMtx s (the cur_part_id,the cur_proc_id)) &ne; mtx_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 817 </font></span><font color="#ff00cc">        (s , Some INVALID_MODE) </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 818 </font></span><font color="#ff00cc">    else if (the cur_proc_id) = HM_PROC_ID then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 819 </font></span><font color="#ff00cc">        (s , Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 820 </font></span><font color="#ff00cc">    else if procPrio &gt; mtxPrio then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 821 </font></span><font color="#ff00cc">        (s , Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 822 </font></span><font color="#ff00cc">    else if getUserPLMtxOwner s (the cur_part_id,mtx_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 823 </font></span><font color="#ff00cc">           let s_setOwned = setUserPLMtxOWNED s (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 824 </font></span><font color="#ff00cc">              s_setOwner = setUserPLMtxOwner s_setOwned (the cur_part_id,mtx_id) (the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 825 </font></span><font color="#ff00cc">              s_setUMtxLck = incrementUserPLMtxLck s_setOwner (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 826 </font></span><font color="#ff00cc">              s_rtnCurPrio = retainCurPrioUserPLMtx s_setUMtxLck (the cur_part_id,mtx_id) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 827 </font></span><font color="#ff00cc">              s_setCurPrio = setPriority s_rtnCurPrio (the cur_part_id,the cur_proc_id) mtxPrio;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 828 </font></span><font color="#ff00cc">              s_setReady =  procReadyHead s_setCurPrio (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 829 </font></span><font color="#ff00cc">            (s_setReady , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 830 </font></span><font color="#ff00cc">    else if the(getUserPLMtxOwner s (the cur_part_id,mtx_id)) = (the cur_proc_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 831 </font></span><font color="#ff00cc">            if the(getUserPLMtxLckCount s (the cur_part_id,mtx_id)) = MAX_LOCK_LVL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 832 </font></span><font color="#ff00cc">               (s , Some INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 833 </font></span><font color="#ff00cc">            else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 834 </font></span><font color="#ff00cc">               (incrementUserPLMtxLck s (the cur_part_id,mtx_id) , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 835 </font></span><font color="#ff00cc">    else if tout = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 836 </font></span><font color="#ff00cc">           (s , Some NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 837 </font></span><font color="#ff00cc">    else if tout = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 838 </font></span><font color="#ff00cc">           let s_setSta = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 839 </font></span><font color="#ff00cc">              s_setWd = setWaitDiff s_setSta (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 840 </font></span><font color="#ff00cc">              s_addMtxQue = rscQPush s_setWd (userPlMtx (the cur_part_id,mtx_id)) (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 841 </font></span><font color="#ff00cc">            (schedule_Abs s_addMtxQue core_id , Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 842 </font></span><font color="#ff00cc">    else let s_setSta = setProcSta s (the cur_part_id,the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 843 </font></span><font color="#ff00cc">            s_setTCtrRsc = setCterRsc s_setSta (the cur_part_id,the cur_proc_id) (Int.int(timer_' s_setSta) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 844 </font></span><font color="#ff00cc">            s_setWd = setWaitDiff s_setTCtrRsc (the cur_part_id,the cur_proc_id) tout;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 845 </font></span><font color="#ff00cc">            s_addMtxQ = rscQPush s_setWd (userPlMtx (the cur_part_id,mtx_id)) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 846 </font></span><font color="#ff00cc">            s_addTimeQ = waitAdd_D s_addMtxQ (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 847 </font></span><font color="#ff00cc">            s_setTCtrRsc = setCterRsc s_addTimeQ (the cur_part_id,the cur_proc_id) (Int.int(timer_' s_addTimeQ) +  tout);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 848 </font></span><font color="#ff00cc">            s_setCntxt = setCntxt s_setTCtrRsc (the cur_part_id,the cur_proc_id) acquireMtx in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 849 </font></span><font color="#ff00cc">          (schedule_Abs s_setCntxt core_id , None)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 850 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 851 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 852 </font></span><font color="#006699"><strong>definition</strong></font> ACQUIRE_MUTEX' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 853 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a STATE_scheme  &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 854 </font></span>  <font color="#ff00cc">&quot;ACQUIRE_MUTEX' s core_id  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 855 </font></span><font color="#ff00cc">   (let cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 856 </font></span><font color="#ff00cc">        cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 857 </font></span><font color="#ff00cc">        t_getCterRsc = getCterRsc s (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 858 </font></span><font color="#ff00cc">   if (the t_getCterRsc) &lt;= Int.int(timer_' s) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 859 </font></span><font color="#ff00cc">       (resetCntxt s (the cur_part_id,the cur_proc_id), TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 860 </font></span><font color="#ff00cc">   else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 861 </font></span><font color="#ff00cc">       (resetCntxt s (the cur_part_id,the cur_proc_id), NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 862 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 863 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 864 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 865 </font></span><font color="#006699"><strong>definition</strong></font> RELEASE_MUTEX <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 866 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; USER_PL_MUTEX_ID_TYPE  &rArr; 'a STATE_scheme  &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 867 </font></span>  <font color="#ff00cc">&quot;RELEASE_MUTEX s core_id mtx_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 868 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 869 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 870 </font></span><font color="#ff00cc">      mtx_attr_op = getUserPLMtxAttrByID s (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 871 </font></span><font color="#ff00cc">      mtxPrio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY(the mtx_attr_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 872 </font></span><font color="#ff00cc">      s_decreLckCnt = decrementUserPLMtxLck s (the cur_part_id,mtx_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 873 </font></span><font color="#ff00cc">    if mtx_attr_op = None then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 874 </font></span><font color="#ff00cc">        (s  , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 875 </font></span><font color="#ff00cc">    else if mtx_id = PREEMPT_MUTEX_ID_TYPE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 876 </font></span><font color="#ff00cc">        (s ,  INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 877 </font></span><font color="#ff00cc">    else if the(getProcUserPLMtx s (the cur_part_id,the cur_proc_id)) &ne; mtx_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 878 </font></span><font color="#ff00cc">        (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 879 </font></span><font color="#ff00cc">    else if the(getUserPLMtxLckCount s_decreLckCnt (the cur_part_id,mtx_id)) = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 880 </font></span><font color="#ff00cc">       let s_setMtxSta =  setUserPLMtxAVAILABLE s_decreLckCnt (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 881 </font></span><font color="#ff00cc">          s_delUMtxOwner = releaseUserPLMtxOwner s_setMtxSta (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 882 </font></span><font color="#ff00cc">          s_setPrio = restoreCurPrioUPLMtx s_delUMtxOwner (the cur_part_id,mtx_id) (the cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 883 </font></span><font color="#ff00cc">          s_setCurProcReady = procReadyHead s_setPrio (the cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 884 </font></span><font color="#ff00cc">       if &not; rscProcQueEmpty s (userPlMtx (the cur_part_id,mtx_id)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 885 </font></span><font color="#ff00cc">            let (s_delMtxQFstProc,pt_delProc_id) = rscQPop s_setCurProcReady (userPlMtx (the cur_part_id,mtx_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 886 </font></span><font color="#ff00cc">                s_stopTimeq = StopTCounter s_delMtxQFstProc (the cur_part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 887 </font></span><font color="#ff00cc">                s_setMtxSta = setUserPLMtxOWNED s_stopTimeq (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 888 </font></span><font color="#ff00cc">                s_setUMtxLck = incrementUserPLMtxLck s_setMtxSta (the cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 889 </font></span><font color="#ff00cc">                s_setOwner = setUserPLMtxOwner s_setUMtxLck (the cur_part_id,mtx_id) (snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 890 </font></span><font color="#ff00cc">                s_rtnCurPrio = retainCurPrioUserPLMtx s_setOwner (the cur_part_id,mtx_id) (the cur_part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 891 </font></span><font color="#ff00cc">                s_setCurPrio = setPriority s_rtnCurPrio (the cur_part_id,snd(the pt_delProc_id)) mtxPrio;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 892 </font></span><font color="#ff00cc">                s_setReady =  procReadyHead s_setCurPrio (the cur_part_id,snd(the pt_delProc_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 893 </font></span><font color="#ff00cc">              (schedule_Abs s_setReady core_id,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 894 </font></span><font color="#ff00cc">        else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 895 </font></span><font color="#ff00cc">             (s_setCurProcReady , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 896 </font></span><font color="#ff00cc">     else (s_decreLckCnt , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 897 </font></span><font color="#ff00cc">    )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 898 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 899 </font></span><font color="#006699"><strong>definition</strong></font> RESET_MUTEX <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 900 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; USER_PL_MUTEX_ID_TYPE  &rArr; 'a STATE_scheme  &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 901 </font></span>  <font color="#ff00cc">&quot;RESET_MUTEX s core_id mtx_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 902 </font></span><font color="#ff00cc">  (let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 903 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 904 </font></span><font color="#ff00cc">      mtx_attr_op = getUserPLMtxAttrByID s (cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 905 </font></span><font color="#ff00cc">      mtxPrio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY(the mtx_attr_op) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 906 </font></span><font color="#ff00cc">    if mtx_attr_op = None  then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 907 </font></span><font color="#ff00cc">        (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 908 </font></span><font color="#ff00cc">    else if mtx_id = PREEMPT_MUTEX_ID_TYPE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 909 </font></span><font color="#ff00cc">        (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 910 </font></span><font color="#ff00cc">    else if  getProcAttr s (cur_part_id,the cur_proc_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 911 </font></span><font color="#ff00cc">        (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 912 </font></span><font color="#ff00cc">    else if the(getProcUserPLMtx s (cur_part_id,the cur_proc_id)) &ne; mtx_id then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 913 </font></span><font color="#ff00cc">        (s , INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 914 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 915 </font></span><font color="#ff00cc">        let s_setMtxLck = resetUserPLMtxLck s (cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 916 </font></span><font color="#ff00cc">            s_setMtxSta = setUserPLMtxAVAILABLE s_setMtxLck (cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 917 </font></span><font color="#ff00cc">            s_delMtxOwner = releaseUserPLMtxOwner s_setMtxSta (cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 918 </font></span><font color="#ff00cc">            s_setPrio = restoreCurPrioUPLMtx s_delMtxOwner (cur_part_id,mtx_id) (cur_part_id,the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 919 </font></span><font color="#ff00cc">            s_setReady = procReadyHead s_setPrio (cur_part_id,the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 920 </font></span><font color="#ff00cc">          if &not; rscProcQueEmpty s (userPlMtx (cur_part_id,mtx_id)) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 921 </font></span><font color="#ff00cc">              let (s_delMtxQFstProc,pt_delProc_id) = rscQPop s_setReady (userPlMtx (cur_part_id,mtx_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 922 </font></span><font color="#ff00cc">                s_stopTimeq = StopTCounter s_delMtxQFstProc (cur_part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 923 </font></span><font color="#ff00cc">                s_setMtxSta = setUserPLMtxOWNED s_stopTimeq (cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 924 </font></span><font color="#ff00cc">                s_setUMtxLck = incrementUserPLMtxLck s_setMtxSta (cur_part_id,mtx_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 925 </font></span><font color="#ff00cc">                s_setOwner = setUserPLMtxOwner s_setUMtxLck (cur_part_id,mtx_id) (snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 926 </font></span><font color="#ff00cc">                s_rtnCurPrio = retainCurPrioUserPLMtx s_setOwner (cur_part_id,mtx_id) (cur_part_id,snd(the pt_delProc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 927 </font></span><font color="#ff00cc">                s_setCurPrio = setPriority s_rtnCurPrio (cur_part_id,snd(the pt_delProc_id)) mtxPrio;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 928 </font></span><font color="#ff00cc">                s_setReady =  procReadyHead s_setCurPrio (cur_part_id,snd(the pt_delProc_id)) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 929 </font></span><font color="#ff00cc">              (schedule_Abs s_setReady core_id,NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 930 </font></span><font color="#ff00cc">          else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 931 </font></span><font color="#ff00cc">               (s_setReady , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 932 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 933 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 934 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 935 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 936 </font></span><font color="#006699"><strong>definition</strong></font> GET_MUTEX_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 937 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; V_CORE_ID_TYPE &rArr; USER_MUTEX_NAME_TYPE  &rArr; 'a STATE_scheme  &times; USER_PL_MUTEX_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 938 </font></span>  <font color="#ff00cc">&quot;GET_MUTEX_ID s cid mtx_name =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 939 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s cid;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 940 </font></span><font color="#ff00cc">       mtx_id_op = getUserPLMtxIDByName s (the cur_part_id) mtx_name in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 941 </font></span><font color="#ff00cc">     if mtx_id_op = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 942 </font></span><font color="#ff00cc">        (s , None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 943 </font></span><font color="#ff00cc">     else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 944 </font></span><font color="#ff00cc">        (s , mtx_id_op, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 945 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 946 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 947 </font></span><font color="#006699"><strong>definition</strong></font> GET_MUTEX_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 948 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; USER_PL_MUTEX_ID_TYPE &rArr; 'a STATE_scheme  &times; USER_PL_MUTEX_STATUS_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 949 </font></span>  <font color="#ff00cc">&quot;GET_MUTEX_STATUS s cid mtx_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 950 </font></span><font color="#ff00cc">  (let cur_part_id = curPartID s cid;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 951 </font></span><font color="#ff00cc">      mtx_attr_op = getUserPLMtxAttrByID s (the cur_part_id,mtx_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 952 </font></span><font color="#ff00cc">   if mtx_attr_op = None  then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 953 </font></span><font color="#ff00cc">      (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 954 </font></span><font color="#ff00cc">   else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 955 </font></span><font color="#ff00cc">        (s ,Some (getMtxStatus s cid mtx_id) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 956 </font></span><font color="#ff00cc">   ) &quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 957 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 958 </font></span><font color="#006699"><strong>definition</strong></font> GET_PROCESS_MUTEX_STATE <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 959 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a STATE_scheme &times; USER_PL_MUTEX_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 960 </font></span>  <font color="#ff00cc">&quot;GET_PROCESS_MUTEX_STATE s core_id proc_id  &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 961 </font></span><font color="#ff00cc">  let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 962 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 963 </font></span><font color="#ff00cc">  if getProcAttr s (the cur_part_id,proc_id) = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 964 </font></span><font color="#ff00cc">       (s , None , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 965 </font></span><font color="#ff00cc">   else if getProcUserPLMtx s (the cur_part_id,proc_id) = Some PREEMPT_MUTEX_ID_TYPE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 966 </font></span><font color="#ff00cc">       (s , Some PREEMPT_MUTEX_ID_TYPE , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 967 </font></span><font color="#ff00cc">   else if getProcUserPLMtx s (the cur_part_id,proc_id) &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 968 </font></span><font color="#ff00cc">       (s , getProcUserPLMtx s (the cur_part_id,proc_id) , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 969 </font></span><font color="#ff00cc">   else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 970 </font></span><font color="#ff00cc">       (s , None , NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 971 </font></span><font color="#ff00cc">   &quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 972 </font></span><font color="#009966"><strong>end</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 973 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 974 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 975 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 976 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 977 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 978 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 979 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 980 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 981 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 982 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 983 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 984 </font></span>
</font></pre>
</body>
</html>
