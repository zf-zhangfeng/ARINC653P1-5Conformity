- theory InterCom
- imports  ["../Scheduler/Design_Sched/Scheduler_D"](https://zf-zhangfeng.github.io/ARINC653P1-5Conformity/Scheduler/Design_Sched/Scheduler_D)
           ["../Base_Ops/Design_BsOps/ProcessAct_D"](https://zf-zhangfeng.github.io/ARINC653P1-5Conformity/Base_Ops/Design_BsOps/ProcessAct_D)

<html>
<head>
<title>InterCom.thy</title>
</head>
<body bgcolor="#ffffff">



<pre><font color="#333333"><span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   1 </font></span><font color="#cc0000">(*</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   2 </font></span><font color="#cc0000">The Interpartition Communication services for ARINC 653 P1-5 are first created by </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   3 </font></span><font color="#cc0000">  GAO Lijie from Zhejiang University.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   4 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">   5 </font></span><font color="#cc0000">And this part is reviewed and corrected by ZHANG Feng from Nanyang Technological University.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   6 </font></span><font color="#cc0000">*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   7 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   8 </font></span><font color="#006699"><strong>section</strong></font><font color="#6600cc">&lsaquo;</font><font color="#6600cc">S</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc">v</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">e</font><font color="#6600cc">s</font><font color="#6600cc"> </font><font color="#6600cc">o</font><font color="#6600cc">f</font><font color="#6600cc"> </font><font color="#6600cc">I</font><font color="#6600cc">n</font><font color="#6600cc">t</font><font color="#6600cc">e</font><font color="#6600cc">r</font><font color="#6600cc">P</font><font color="#6600cc">a</font><font color="#6600cc">r</font><font color="#6600cc">t</font><font color="#6600cc">i</font><font color="#6600cc">t</font><font color="#6600cc">i</font><font color="#6600cc">o</font><font color="#6600cc">n</font><font color="#6600cc"> </font><font color="#6600cc">C</font><font color="#6600cc">o</font><font color="#6600cc">m</font><font color="#6600cc">m</font><font color="#6600cc">u</font><font color="#6600cc">n</font><font color="#6600cc">i</font><font color="#6600cc">c</font><font color="#6600cc">a</font><font color="#6600cc">t</font><font color="#6600cc">i</font><font color="#6600cc">o</font><font color="#6600cc">n</font><font color="#6600cc">s</font><font color="#6600cc">&rsaquo;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   9 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  10 </font></span><font color="#006699"><strong>theory</strong></font> InterCom
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  11 </font></span><font color="#009966"><strong>imports</strong></font> <font color="#ff00cc">&quot;../Scheduler/Design_Sched/Scheduler_D&quot;</font> <font color="#ff00cc">&quot;../Base_Ops/Design_BsOps/ProcessAct_D&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  12 </font></span><font color="#009966"><strong>begin</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  13 </font></span><font color="#cc0000">(*CHANNEL OPERATIONS*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  14 </font></span><font color="#cc0000">(*the para port_id is the source port id*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  15 </font></span><font color="#006699"><strong>definition</strong></font> chQueWrite <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  16 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; PORT_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  17 </font></span>  <font color="#ff00cc">&quot;chQueWrite s part_id srcQ_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  18 </font></span><font color="#ff00cc">   let </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  19 </font></span><font color="#ff00cc">       srcQ_attr_op = getPortAttrByID s (part_id, srcQ_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  20 </font></span><font color="#ff00cc">       srcQ_name = portName (the srcQ_attr_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  21 </font></span><font color="#ff00cc">       ch_cfg_op = getChBySrcPort (part_id, srcQ_name);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  22 </font></span><font color="#ff00cc">       dstQ_part_name = chnlQueDest_PortName (the ch_cfg_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  23 </font></span><font color="#ff00cc">       dstQ_id = getPortIDByName s (fst dstQ_part_name) (snd dstQ_part_name) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  24 </font></span><font color="#ff00cc">    if ch_cfg_op = None &or; dstQ_id = None then s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  25 </font></span><font color="#ff00cc">    else if quePortFull s (part_id, the dstQ_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  26 </font></span><font color="#ff00cc">      (if &not; quePortFull s (part_id, srcQ_id) then s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  27 </font></span><font color="#ff00cc">       else let s_rcvOneMsg = rcvQueMsg s (part_id, srcQ_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  28 </font></span><font color="#ff00cc">              s_rcvOneMsg_dtlFstDst = dltQueFstMsg (fst s_rcvOneMsg) (part_id, the dstQ_id) in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  29 </font></span><font color="#ff00cc">            insertQueMsg (fst s_rcvOneMsg) (part_id, the dstQ_id) (the(snd s_rcvOneMsg))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  30 </font></span><font color="#ff00cc">      )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  31 </font></span><font color="#ff00cc">    else let s_rcvOneMsg = rcvQueMsg s (part_id, srcQ_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  32 </font></span><font color="#ff00cc">      insertQueMsg (fst s_rcvOneMsg) (part_id, the dstQ_id) (the(snd s_rcvOneMsg))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  33 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  34 </font></span><font color="#cc0000">(*use port_name to find port_id*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  35 </font></span><font color="#006699"><strong>function</strong></font> getPortIDsPortIDsByNames <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  36 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; (PART_ID_TYPE &times; PORT_NAME_TYPE) set &rArr; (PART_ID_TYPE &times; PORT_ID_TYPE) set&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  37 </font></span>  <font color="#ff00cc">&quot;getPortIDsPortIDsByNames s pps =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  38 </font></span><font color="#ff00cc">  (if pps = {} then {} </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  39 </font></span><font color="#ff00cc">  else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  40 </font></span><font color="#ff00cc">    let onePP = SOME pp. pp &isin; pps;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  41 </font></span><font color="#ff00cc">      port_id_op = getPortIDByName s (fst onePP) (snd onePP);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  42 </font></span><font color="#ff00cc">      part_id = fst onePP in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  43 </font></span><font color="#ff00cc">    case port_id_op of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  44 </font></span><font color="#ff00cc">      None &rArr; getPortIDsPortIDsByNames s (pps - {onePP}) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  45 </font></span><font color="#ff00cc">      Some port_id &rArr; {(part_id, port_id)} &cup; getPortIDsPortIDsByNames s (pps - {onePP}))&quot;</font> <font color="#006699"><strong>by</strong></font> auto
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  46 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  47 </font></span><font color="#cc0000">(*the para port_id is the source port id*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  48 </font></span><font color="#006699"><strong>definition</strong></font> chSampWrite <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  49 </font></span><font color="#ff00cc">                        PORT_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  50 </font></span><font color="#ff00cc">&quot;chSampWrite s part_id srcS_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  51 </font></span><font color="#ff00cc">let srcQ_attr_op = getPortAttrByID s (part_id, srcS_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  52 </font></span><font color="#ff00cc">  msg_t = readSamPortMsg s (part_id, srcS_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  53 </font></span><font color="#ff00cc">  srcS_name = portName (the srcQ_attr_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  54 </font></span><font color="#ff00cc">  t = Int.int (sysClk s);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  55 </font></span><font color="#ff00cc">  ch_cfg_op = getChBySrcPort (part_id, srcS_name);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  56 </font></span><font color="#ff00cc">  dstQ_part_names = chnlSampDest_PortNames (the ch_cfg_op);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  57 </font></span><font color="#ff00cc">  dstQ_portids = getPortIDsPortIDsByNames s dstQ_part_names in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  58 </font></span><font color="#ff00cc">if ch_cfg_op = None &or; dstQ_portids = {} then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  59 </font></span><font color="#ff00cc">  s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  60 </font></span><font color="#ff00cc">else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  61 </font></span><font color="#ff00cc">  writeSamPortsMsg s dstQ_portids (the msg_t)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  62 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  63 </font></span><font color="#cc0000">(*=== CREATE_SAMPLING_PORT service ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  64 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  65 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_SAMPLING_PORT <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  66 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; INTER_PORT_ATTR_TYPE  &rArr; 'a STATE_scheme &times; PORT_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  67 </font></span>  <font color="#ff00cc">&quot;CREATE_SAMPLING_PORT s core_id port_attr &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  68 </font></span><font color="#ff00cc">    let port_name = portName port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  69 </font></span><font color="#ff00cc">       port_msgsz = portMsgSz port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  70 </font></span><font color="#ff00cc">       port_direction = portDirect port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  71 </font></span><font color="#ff00cc">       port_rfrp = portSamRefr port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  72 </font></span><font color="#ff00cc">       cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  73 </font></span><font color="#ff00cc">       part_cfg = getPartByID (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  74 </font></span><font color="#ff00cc">       ports_created = portsCreated s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  75 </font></span><font color="#ff00cc">       port_attrIncfg_op = getPortAttrByName (the cur_part_id) port_name</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  76 </font></span><font color="#ff00cc">    in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  77 </font></span><font color="#ff00cc">      if port_attrIncfg_op = None &or; ports_created &ge; portsAmount then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  78 </font></span><font color="#ff00cc">        (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  79 </font></span><font color="#ff00cc">      else if &not;portNameInPart (the cur_part_id) port_name then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  80 </font></span><font color="#ff00cc">        (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  81 </font></span><font color="#ff00cc">      else if getPortIDByName s (the cur_part_id) port_name &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  82 </font></span><font color="#ff00cc">        (s, None, NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  83 </font></span><font color="#ff00cc">      else if port_msgsz &le; 0 &or; port_msgsz &gt;  MAX_MSG_SZ_VALUE &or; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  84 </font></span><font color="#ff00cc">               port_msgsz &ne; portMsgSz (the port_attrIncfg_op) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  85 </font></span><font color="#ff00cc">          (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  86 </font></span><font color="#ff00cc">      else if port_direction &ne; portDirect (the port_attrIncfg_op) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  87 </font></span><font color="#ff00cc">          (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  88 </font></span><font color="#ff00cc">      else if port_rfrp &le; 0 &or; port_rfrp &gt; Int.int MAX_PRIORITY_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  89 </font></span><font color="#ff00cc">          (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  90 </font></span><font color="#ff00cc">      else if the(getPartMode s (the cur_part_id)) = NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  91 </font></span><font color="#ff00cc">          (s, None, INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  92 </font></span><font color="#ff00cc">      else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  93 </font></span><font color="#ff00cc">        let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  94 </font></span><font color="#ff00cc">              port_id = newPortID s (the cur_part_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  95 </font></span><font color="#ff00cc">          in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  96 </font></span><font color="#ff00cc">              (createPort s (the cur_part_id, port_id) port_attr, None, NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  97 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  98 </font></span><font color="#cc0000">(*=== WRITE_SAMPLING_MESSAGE service ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  99 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 100 </font></span><font color="#006699"><strong>definition</strong></font> WRITE_SAMPLING_MESSAGE <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 101 </font></span><font color="#ff00cc">&quot;'a STATE_scheme&rArr;V_CORE_ID_TYPE&rArr;PORT_ID_TYPE&rArr;Message&times;SYSTEM_TIME_TYPE&rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 102 </font></span><font color="#ff00cc">  'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 103 </font></span><font color="#ff00cc">&quot;WRITE_SAMPLING_MESSAGE s core_id port_id msg &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 104 </font></span><font color="#ff00cc">let cur_part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 105 </font></span><font color="#ff00cc">  port_attr = getPortAttrByID s (cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 106 </font></span><font color="#ff00cc">  s_writePort = writeSamPortMsg s (cur_part_id, port_id) msg in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 107 </font></span><font color="#ff00cc">if &not;isSamPort (the port_attr) &or; &not; portCreated s (cur_part_id, port_id) </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 108 </font></span><font color="#ff00cc">   then (s, INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 109 </font></span><font color="#ff00cc">else if portMsgSz (the (getPortAttrByID s (cur_part_id, port_id))) </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 110 </font></span><font color="#ff00cc">        &gt; MAX_MSG_SZ_VALUE then (s, INVALID_CONFIG)  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 111 </font></span><font color="#ff00cc">else if portMsgSz (the (getPortAttrByID s (cur_part_id, port_id))) </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 112 </font></span><font color="#ff00cc">        &le; 0 then (s, INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 113 </font></span><font color="#ff00cc">else if portDirect (the port_attr) &ne; SOURCE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 114 </font></span><font color="#ff00cc">     (s, INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 115 </font></span><font color="#ff00cc">else (chSampWrite s_writePort (cur_part_id) port_id, NO_ERROR)&quot;</font>    
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 116 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 117 </font></span><font color="#cc0000">(*=== READ_SAMPLING_MESSAGE service ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 118 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 119 </font></span><font color="#006699"><strong>definition</strong></font> READ_SAMPLING_MESSAGE <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 120 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE  &rArr; Message option &times; VALIDITY_TYPE &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 121 </font></span>  <font color="#ff00cc">&quot;READ_SAMPLING_MESSAGE s core_id port_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 122 </font></span><font color="#ff00cc">    let </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 123 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 124 </font></span><font color="#ff00cc">      port_attr = getPortAttrByID s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 125 </font></span><font color="#ff00cc">      message_size = portMsgSz (the port_attr)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 126 </font></span><font color="#ff00cc">    in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 127 </font></span><font color="#ff00cc">    if &not; isSamPort (the port_attr) &or; &not; portCreated s (the cur_part_id, port_id) then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 128 </font></span><font color="#ff00cc">        (None, INVALID, INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 129 </font></span><font color="#ff00cc">    else if portDirect (the port_attr) &ne; DESTINATION then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 130 </font></span><font color="#ff00cc">        (None, INVALID, INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 131 </font></span><font color="#ff00cc">    else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 132 </font></span><font color="#ff00cc">       let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 133 </font></span><font color="#ff00cc">          msg_wrtime = readSamPortMsg s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 134 </font></span><font color="#ff00cc">          message = fst (the msg_wrtime);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 135 </font></span><font color="#ff00cc">          write_time = snd (the msg_wrtime);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 136 </font></span><font color="#ff00cc">          sys_time = sysClk s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 137 </font></span><font color="#ff00cc">       in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 138 </font></span><font color="#ff00cc">          if samPortEmpty s (the cur_part_id, port_id) = True then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 139 </font></span><font color="#ff00cc">            (None, INVALID, NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 140 </font></span><font color="#ff00cc">          else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 141 </font></span><font color="#ff00cc">            let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 142 </font></span><font color="#ff00cc">               len = MSG_SZ message;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 143 </font></span><font color="#ff00cc">               refresh_period = portSamRefr (the port_attr)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 144 </font></span><font color="#ff00cc">            in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 145 </font></span><font color="#ff00cc">              if sys_time - Int.nat write_time &le; Int.nat refresh_period then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 146 </font></span><font color="#ff00cc">                 (Some message, VALID, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 147 </font></span><font color="#ff00cc">              else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 148 </font></span><font color="#ff00cc">                 (Some message, INVALID, NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 149 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 150 </font></span><font color="#cc0000">(*=== GET_SAMPLING_PORT_ID service ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 151 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 152 </font></span><font color="#006699"><strong>definition</strong></font> GET_SAMPLING_PORT_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 153 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_NAME_TYPE &rArr; PORT_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 154 </font></span>  <font color="#ff00cc">&quot;GET_SAMPLING_PORT_ID s core_id port_name &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 155 </font></span><font color="#ff00cc">    let </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 156 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 157 </font></span><font color="#ff00cc">      port_id = getPortIDByName s (the cur_part_id) port_name</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 158 </font></span><font color="#ff00cc">    in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 159 </font></span><font color="#ff00cc">    if &not; portNameInCfg (the cur_part_id, port_name) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 160 </font></span><font color="#ff00cc">      (None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 161 </font></span><font color="#ff00cc">    else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 162 </font></span><font color="#ff00cc">      (port_id, NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 163 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 164 </font></span><font color="#cc0000">(*=== GET_SAMPLING_PORT_STATUS ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 165 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 166 </font></span><font color="#006699"><strong>definition</strong></font> GET_SAMPLING_PORT_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 167 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE &rArr; SAMP_PORT_STATUS_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 168 </font></span>  <font color="#ff00cc">&quot;GET_SAMPLING_PORT_STATUS s core_id port_id &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 169 </font></span><font color="#ff00cc">   let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 170 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 171 </font></span><font color="#ff00cc">      port_attr = getPortAttrByID s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 172 </font></span><font color="#ff00cc">      system_time = sysClk s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 173 </font></span><font color="#ff00cc">      samp_status = getSamStatus s (the cur_part_id, port_id) (Int.int system_time)in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 174 </font></span><font color="#ff00cc">  if &not; isSamPort (the port_attr) &or; &not; portCreated s (the cur_part_id, port_id) then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 175 </font></span><font color="#ff00cc">      (None, INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 176 </font></span><font color="#ff00cc">  else (Some samp_status , NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 177 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 178 </font></span><font color="#cc0000">(*=======queuing========*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 179 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 180 </font></span><font color="#cc0000">(*=== GET_SAMPLING_PORT_STATUS ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 181 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 182 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_QUEUING_PORT <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 183 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; INTER_PORT_ATTR_TYPE  &rArr; 'a STATE_scheme &times; PORT_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 184 </font></span>  <font color="#ff00cc">&quot;CREATE_QUEUING_PORT s core_id port_attr &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 185 </font></span><font color="#ff00cc">    let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 186 </font></span><font color="#ff00cc">       port_name = portName port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 187 </font></span><font color="#ff00cc">       port_msgsz = portMsgSz port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 188 </font></span><font color="#ff00cc">       max_nb_message = portQueLen port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 189 </font></span><font color="#ff00cc">       port_direction = portDirect port_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 190 </font></span><font color="#ff00cc">       cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 191 </font></span><font color="#ff00cc">       part_cfg = getPartByID (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 192 </font></span><font color="#ff00cc">       ports_created = portsCreated s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 193 </font></span><font color="#ff00cc">       port_attrIncfg_op = getPortAttrByName (the cur_part_id) port_name</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 194 </font></span><font color="#ff00cc">     in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 195 </font></span><font color="#ff00cc">      if port_attrIncfg_op = None &or; ports_created  &ge; portsAmount then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 196 </font></span><font color="#ff00cc">        (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 197 </font></span><font color="#ff00cc">      else if portNameInPart (the cur_part_id) port_name then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 198 </font></span><font color="#ff00cc">        (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 199 </font></span><font color="#ff00cc">      else if &not; getPortIDByName s (the cur_part_id) port_name &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 200 </font></span><font color="#ff00cc">        (s, None, NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 201 </font></span><font color="#ff00cc">      else if port_msgsz &le; 0 &or; port_msgsz &gt;  MAX_MSG_SZ_VALUE &or; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 202 </font></span><font color="#ff00cc">              port_msgsz &ne; portMsgSz (the port_attrIncfg_op) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 203 </font></span><font color="#ff00cc">        (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 204 </font></span><font color="#ff00cc">      else if port_direction &ne; portDirect (the port_attrIncfg_op) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 205 </font></span><font color="#ff00cc">        (s, None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 206 </font></span><font color="#ff00cc">      else if the(getPartMode s (the cur_part_id)) = NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 207 </font></span><font color="#ff00cc">          (s, None, INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 208 </font></span><font color="#ff00cc">      else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 209 </font></span><font color="#ff00cc">          let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 210 </font></span><font color="#ff00cc">              port_id = newPortID s (the cur_part_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 211 </font></span><font color="#ff00cc">          in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 212 </font></span><font color="#ff00cc">              (createPort s (the cur_part_id, port_id) port_attr, Some port_id, NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 213 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 214 </font></span><font color="#006699"><strong>definition</strong></font> SEND_QUEUING_MESSAGE <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 215 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE &rArr; Message &rArr; SYSTEM_TIME_TYPE  &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 216 </font></span>  <font color="#ff00cc">&quot;SEND_QUEUING_MESSAGE s core_id port_id msg time_out &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 217 </font></span><font color="#ff00cc">    let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 218 </font></span><font color="#ff00cc">        cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 219 </font></span><font color="#ff00cc">        port_attr = getPortAttrByID s (the cur_part_id, port_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 220 </font></span><font color="#ff00cc">    in  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 221 </font></span><font color="#ff00cc">      if &not; isQuePort (the port_attr) &or; &not; portCreated s (the cur_part_id, port_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 222 </font></span><font color="#ff00cc">        (s, Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 223 </font></span><font color="#ff00cc">      else if invalTout time_out then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 224 </font></span><font color="#ff00cc">        (s, Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 225 </font></span><font color="#ff00cc">      else if msg &gt; portMsgSz (the port_attr) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 226 </font></span><font color="#ff00cc">        (s, Some INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 227 </font></span><font color="#ff00cc">      else if msg &le; 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 228 </font></span><font color="#ff00cc">        (s, Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 229 </font></span><font color="#ff00cc">      else if portDirect (the port_attr) &ne; SOURCE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 230 </font></span><font color="#ff00cc">        (s, Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 231 </font></span><font color="#ff00cc">      else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 232 </font></span><font color="#ff00cc">        let port_full = quePortFull s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 233 </font></span><font color="#ff00cc">            part_sta = partitions_' s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 234 </font></span><font color="#ff00cc">            cur_proc_id = curProc part_sta (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 235 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 236 </font></span><font color="#ff00cc">            s_alone = procAlone s (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 237 </font></span><font color="#ff00cc">            s_cter_Sta = setProcSta s_alone (the cur_part_id, the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 238 </font></span><font color="#ff00cc">            s_cter = setCterRsc s_cter_Sta (the cur_part_id, the cur_proc_id) time_out;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 239 </font></span><font color="#ff00cc">            s_setWd = setWaitDiff s_cter (the cur_part_id, the cur_proc_id) time_out;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 240 </font></span><font color="#ff00cc">            </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 241 </font></span><font color="#ff00cc">            s_tcter = if time_out = -1 then s_setWd </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 242 </font></span><font color="#ff00cc">                      else waitAdd_D s_setWd (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 243 </font></span><font color="#ff00cc">            s_tcter_rscQ = rscQPush s_tcter (interC (the cur_part_id, port_id)) (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 244 </font></span><font color="#ff00cc">            s_setCntxt = setCntxt s_tcter_rscQ (the cur_part_id, the cur_proc_id) (wrQueu((the cur_part_id, port_id), msg))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 245 </font></span><font color="#ff00cc">        in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 246 </font></span><font color="#ff00cc">        if &not; port_full then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 247 </font></span><font color="#ff00cc">            let s_insertQMsg = insertQueMsg s (the cur_part_id, port_id) msg in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 248 </font></span><font color="#ff00cc">            (chQueWrite s_insertQMsg (the cur_part_id) port_id, Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 249 </font></span><font color="#ff00cc">        else if time_out = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 250 </font></span><font color="#ff00cc">          (s, Some NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 251 </font></span><font color="#ff00cc">        else if (the cur_proc_id) = HM_PROC_ID &or; getProcUserPLMtx s (the cur_part_id, the cur_proc_id) &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 252 </font></span><font color="#ff00cc">          (s, Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 253 </font></span><font color="#ff00cc">        else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 254 </font></span><font color="#ff00cc">          (schedule_Abs s_setCntxt core_id, None)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 255 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 256 </font></span><font color="#cc0000">(*the actions after asking for process scheduling*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 257 </font></span><font color="#006699"><strong>definition</strong></font> SEND_QUEUING_MESSAGE' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 258 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE &rArr; Message &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 259 </font></span>  <font color="#ff00cc">&quot;SEND_QUEUING_MESSAGE' s core_id port_id msg &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 260 </font></span><font color="#ff00cc">  (let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 261 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 262 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 263 </font></span><font color="#ff00cc">      cntxt = getCntxt s (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 264 </font></span><font color="#ff00cc">      cter = getCterRsc s (the cur_part_id, the cur_proc_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 265 </font></span><font color="#ff00cc">   in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 266 </font></span><font color="#ff00cc">      if the cter = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 267 </font></span><font color="#ff00cc">         (resetCntxt s (the cur_part_id, the cur_proc_id), TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 268 </font></span><font color="#ff00cc">      else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 269 </font></span><font color="#ff00cc">        let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 270 </font></span><font color="#ff00cc">           s_stopCter = stopCterRsc s (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 271 </font></span><font color="#ff00cc">           s_sendMsg = insertQueMsg s_stopCter (the cur_part_id, port_id) msg;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 272 </font></span><font color="#ff00cc">           s_sendMsg_rst = resetCntxt s_sendMsg (the cur_part_id, the cur_proc_id)  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 273 </font></span><font color="#ff00cc">        in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 274 </font></span><font color="#ff00cc">         (chQueWrite s_sendMsg_rst (the cur_part_id) port_id, NO_ERROR))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 275 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 276 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 277 </font></span><font color="#cc0000">(*=== RECEIVE_QUEUING_MESSAGE service===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 278 </font></span><font color="#cc0000">(*process will recive message from port_id*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 279 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 280 </font></span><font color="#006699"><strong>definition</strong></font> RECEIVE_QUEUING_MESSAGE <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 281 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; 'a STATE_scheme &times; MSG_SZ_TYPE option &times; RETURN_CODE_TYPE option&quot;</font>  <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 282 </font></span>  <font color="#ff00cc">&quot;RECEIVE_QUEUING_MESSAGE s core_id port_id time_out &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 283 </font></span><font color="#ff00cc">   let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 284 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 285 </font></span><font color="#ff00cc">      port_attr = getPortAttrByID s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 286 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 287 </font></span><font color="#ff00cc">    in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 288 </font></span><font color="#ff00cc">      if &not; isQuePort (the port_attr) &or; &not; portCreated s (the cur_part_id, port_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 289 </font></span><font color="#ff00cc">        (s, None, Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 290 </font></span><font color="#ff00cc">      else if Int.nat time_out &ge; INVALID_TIMEOUT_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 291 </font></span><font color="#ff00cc">        (s, None, Some INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 292 </font></span><font color="#ff00cc">      else if portDirect (the port_attr) &ne; DESTINATION then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 293 </font></span><font color="#ff00cc">        (s, None, Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 294 </font></span><font color="#ff00cc">      else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 295 </font></span><font color="#ff00cc">        if &not; quePortEmpty s (the cur_part_id, port_id) then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 296 </font></span><font color="#ff00cc">            let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 297 </font></span><font color="#ff00cc">                state_msg = rcvQueMsg s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 298 </font></span><font color="#ff00cc">                s' = fst state_msg;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 299 </font></span><font color="#ff00cc">                msg = snd state_msg</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 300 </font></span><font color="#ff00cc">            in (s', msg, Some NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 301 </font></span><font color="#ff00cc">        else if time_out = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 302 </font></span><font color="#ff00cc">            (s, None, Some NOT_AVAILABLE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 303 </font></span><font color="#ff00cc">        else if (the cur_proc_id) = HM_PROC_ID &or; getProcUserPLMtx s (the cur_part_id, the cur_proc_id) &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 304 </font></span><font color="#ff00cc">            (s, None, Some INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 305 </font></span><font color="#ff00cc">        else  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 306 </font></span><font color="#ff00cc">          let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 307 </font></span><font color="#ff00cc">            s_alone = procAlone s (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 308 </font></span><font color="#ff00cc">            s_setSta = setProcSta s_alone (the cur_part_id, the cur_proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 309 </font></span><font color="#ff00cc">            s_set_tCounterRsc = setCterRsc s_setSta (the cur_part_id, the cur_proc_id) time_out;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 310 </font></span><font color="#ff00cc">            s_setWd = setWaitDiff s_set_tCounterRsc (the cur_part_id, the cur_proc_id) time_out;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 311 </font></span><font color="#ff00cc">            s_addTimeQ = if time_out = -1 then s_setWd </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 312 </font></span><font color="#ff00cc">                         else  waitAdd_D s_setWd (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 313 </font></span><font color="#ff00cc">            s_tcter_rscQ = rscQPush s_addTimeQ (interC (the cur_part_id, port_id)) (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 314 </font></span><font color="#ff00cc">            s_setCntxt = setCntxt s_tcter_rscQ (the cur_part_id, the cur_proc_id) (rdQueu (the cur_part_id, port_id))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 315 </font></span><font color="#ff00cc">          in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 316 </font></span><font color="#ff00cc">            (schedule_Abs s_setCntxt core_id, None, None)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 317 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 318 </font></span><font color="#cc0000">(*after asking for process scheduling*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 319 </font></span><font color="#006699"><strong>definition</strong></font> RECEIVE_QUEUING_MESSAGE' <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 320 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE &rArr; 'a STATE_scheme &times; MSG_SZ_TYPE option &times; RETURN_CODE_TYPE&quot;</font>  <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 321 </font></span>  <font color="#ff00cc">&quot;RECEIVE_QUEUING_MESSAGE' s core_id port_id &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 322 </font></span><font color="#ff00cc">    let </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 323 </font></span><font color="#ff00cc">        cur_part_id = curPartID s core_id; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 324 </font></span><font color="#ff00cc">        cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 325 </font></span><font color="#ff00cc">        cntxt = getCntxt s (the cur_part_id, the cur_proc_id); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 326 </font></span><font color="#ff00cc">        cter = getCterRsc s (the cur_part_id, the cur_proc_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 327 </font></span><font color="#ff00cc">    in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 328 </font></span><font color="#ff00cc">    if the cter = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 329 </font></span><font color="#ff00cc">       (resetCntxt s (the cur_part_id, the cur_proc_id), None, TIMED_OUT)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 330 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 331 </font></span><font color="#ff00cc">      let                     </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 332 </font></span><font color="#ff00cc">           state_msg = rcvQueMsg s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 333 </font></span><font color="#ff00cc">           s' = fst state_msg;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 334 </font></span><font color="#ff00cc">           msg = snd state_msg</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 335 </font></span><font color="#ff00cc">      in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 336 </font></span><font color="#ff00cc">      (resetCntxt s' (the cur_part_id, the cur_proc_id), msg, NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 337 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 338 </font></span><font color="#cc0000">(*=== GET_QUEUING_PORT_ID service ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 339 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 340 </font></span><font color="#006699"><strong>definition</strong></font> GET_QUEUING_PORT_ID <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 341 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_NAME_TYPE &rArr; PORT_ID_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 342 </font></span>  <font color="#ff00cc">&quot;GET_QUEUING_PORT_ID s core_id port_name &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 343 </font></span><font color="#ff00cc">    let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 344 </font></span><font color="#ff00cc">        cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 345 </font></span><font color="#ff00cc">        port_id = getPortIDByName s (the cur_part_id) port_name</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 346 </font></span><font color="#ff00cc">    in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 347 </font></span><font color="#ff00cc">    if &not; portNameInCfg ((the cur_part_id), port_name) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 348 </font></span><font color="#ff00cc">       (None, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 349 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 350 </font></span><font color="#ff00cc">        (port_id, NO_ERROR)&quot;</font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 351 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 352 </font></span><font color="#cc0000">(*=== GET_QUEUING_PORT_STATUS service ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 353 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 354 </font></span><font color="#006699"><strong>definition</strong></font> GET_QUEUING_PORT_STATUS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 355 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE &rArr; QUE_PORT_STATUS_TYPE option &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 356 </font></span>  <font color="#ff00cc">&quot;GET_QUEUING_PORT_STATUS s core_id port_id &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 357 </font></span><font color="#ff00cc">   let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 358 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 359 </font></span><font color="#ff00cc">      port_attr = getPortAttrByID s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 360 </font></span><font color="#ff00cc">      que_status = getQueStatus s (the cur_part_id, port_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 361 </font></span><font color="#ff00cc">  if &not; isQuePort (the port_attr) &or; &not; portCreated s (the cur_part_id, port_id) then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 362 </font></span><font color="#ff00cc">      (None, INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 363 </font></span><font color="#ff00cc">  else (Some que_status , NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 364 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 365 </font></span><font color="#cc0000">(*=== CLEAR_QUEUING_PORT service ===*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 366 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 367 </font></span><font color="#006699"><strong>definition</strong></font> CLEAR_QUEUING_PORT <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 368 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; PORT_ID_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 369 </font></span>  <font color="#ff00cc">&quot;CLEAR_QUEUING_PORT s core_id port_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 370 </font></span><font color="#ff00cc">   let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 371 </font></span><font color="#ff00cc">      cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 372 </font></span><font color="#ff00cc">      port_attr = getPortAttrByID s (the cur_part_id, port_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 373 </font></span><font color="#ff00cc">      que_status = getQueStatus s (the cur_part_id, port_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 374 </font></span><font color="#ff00cc">   in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 375 </font></span><font color="#ff00cc">     if &not; isQuePort (the port_attr) &or; &not; portCreated s (the cur_part_id, port_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 376 </font></span><font color="#ff00cc">       (s, INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 377 </font></span><font color="#ff00cc">     else if portDirect (the port_attr) &ne; DESTINATION then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 378 </font></span><font color="#ff00cc">       (s, INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 379 </font></span><font color="#ff00cc">     else if quePortEmpty s (the cur_part_id, port_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 380 </font></span><font color="#ff00cc">       (s, NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 381 </font></span><font color="#ff00cc">     else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 382 </font></span><font color="#ff00cc">      (emptyQueMsgL s (the cur_part_id, port_id), NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 383 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 384 </font></span><font color="#009966"><strong>end</strong></font>
</font></pre>
</body>
</html>
